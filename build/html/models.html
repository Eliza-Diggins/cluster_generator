
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Cluster Models &#8212; cluster_generator  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="_static/pygments.css?v=fd506691" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="_static/css/tooltipster.custom.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/tooltipster.bundle.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/tooltipster-sideTip-shadow.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/tooltipster-sideTip-punk.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/tooltipster-sideTip-noir.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/tooltipster-sideTip-light.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/tooltipster-sideTip-borderless.min.css" />
    <link rel="stylesheet" type="text/css" href="_static/css/micromodal.css" />
    <link rel="stylesheet" type="text/css" href="_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script src="_static/jquery.js?v=5d32c60e"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js?v=ccbe24c1"></script>
    <script src="_static/doctools.js?v=888ff710"></script>
    <script src="_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="_static/copybutton.js?v=f281be69"></script>
    <script src="_static/js/hoverxref.js"></script>
    <script src="_static/js/tooltipster.bundle.min.js"></script>
    <script src="_static/js/micromodal.min.js"></script>
    <script src="_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'models';</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Collections" href="collections.html" />
    <link rel="prev" title="Gravity Theories" href="gravity.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="index.html">
  
  
  
  
  
    <p class="title logo__title">cluster_generator  documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="Getting_Started.html">
                        Quickstart Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="gravity.html">
                        Gravity Theories
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Cluster Models
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="collections.html">
                        Collections
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="examples.html">
                        Examples
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api.html">
                        API
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
    <label class="sidebar-toggle secondary-toggle" for="__secondary">
      <span class="fa-solid fa-outdent"></span>
    </label>
  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="Getting_Started.html">
                        Quickstart Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="gravity.html">
                        Gravity Theories
                      </a>
                    </li>
                

                    <li class="nav-item current active">
                      <a class="nav-link nav-internal" href="#">
                        Cluster Models
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="collections.html">
                        Collections
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="examples.html">
                        Examples
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="api.html">
                        API
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    <li class="breadcrumb-item active" aria-current="page">Cluster Models</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <section id="cluster-models">
<span id="id1"></span><h1><a class="toc-backref" href="#id4" role="doc-backlink">Cluster Models</a><a class="headerlink" href="#cluster-models" title="Permalink to this heading">#</a></h1>
<p>The <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> class is one of the core structures available in <code class="docutils literal notranslate"><span class="pre">cluster_generator</span></code>. These objects hold all of
the data related to a single cluster being modeled. The user can use a <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> object to generate particle distributions,
enforce hydrostatic equilibrium, virialize halos, and generate intial conditions. Furthermore, the user can generate
<a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> objects using a variety of pre-built protocols using <a class="reference internal" href="_as_gen/radial_profiles.RadialProfile.html#radial_profiles.RadialProfile" title="radial_profiles.RadialProfile"><code class="xref py py-class docutils literal notranslate"><span class="pre">radial_profiles.RadialProfile</span></code></a> objects to provide necessary fields of data.</p>
<hr style="color:black"><nav class="contents" id="contents">
<p class="topic-title">Contents</p>
<ul class="simple">
<li><p><a class="reference internal" href="#cluster-models" id="id4">Cluster Models</a></p>
<ul>
<li><p><a class="reference internal" href="#cluster-models-mathematical-overview" id="id5">Cluster Models: Mathematical Overview</a></p>
<ul>
<li><p><a class="reference internal" href="#newtonian-gravity" id="id6">Newtonian Gravity</a></p></li>
<li><p><a class="reference internal" href="#mond-gravity-aqual" id="id7">MOND Gravity: AQUAL</a></p></li>
<li><p><a class="reference internal" href="#mond-gravity-qumond" id="id8">MOND Gravity: QUMOND</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#generating-a-model-clustermodel-using-radial-profiles" id="id9">Generating a <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> Using Radial Profiles</a></p>
<ul>
<li><p><a class="reference internal" href="#clustermodel-from-gas-density-and-gas-temperature-profiles" id="id10"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Gas Temperature Profiles</a></p></li>
<li><p><a class="reference internal" href="#clustermodel-from-gas-density-and-total-density-profiles" id="id11"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Total Density Profiles</a></p></li>
<li><p><a class="reference internal" href="#clustermodel-from-gas-density-and-gas-entropy-profiles" id="id12"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Gas Entropy Profiles</a></p></li>
<li><p><a class="reference internal" href="#clustermodel-without-gas" id="id13"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> Without Gas</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#checking-the-hydrostatic-equilibrium" id="id14">Checking the Hydrostatic Equilibrium</a></p></li>
<li><p><a class="reference internal" href="#setting-a-magnetic-field-strength-profile" id="id15">Setting a Magnetic Field Strength Profile</a></p>
<ul>
<li><p><a class="reference internal" href="#setting-a-magnetic-field-from-beta" id="id16">Setting a Magnetic Field from <span class="math notranslate nohighlight">\(\beta\)</span></a></p></li>
<li><p><a class="reference internal" href="#setting-a-magnetic-field-from-plasma-density" id="id17">Setting a Magnetic Field from plasma density</a></p></li>
</ul>
</li>
<li><p><a class="reference internal" href="#adding-other-fields" id="id18">Adding Other Fields</a></p></li>
<li><p><a class="reference internal" href="#reading-and-writing-model-clustermodel-objects-to-and-from-disk" id="id19">Reading and Writing <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> Objects to and from Disk</a></p></li>
<li><p><a class="reference internal" href="#non-physical-systems" id="id20">Non-Physical Systems</a></p></li>
</ul>
</li>
</ul>
</nav>
<hr style="height:10px;background-color:black"><section id="cluster-models-mathematical-overview">
<span id="math-overview-models"></span><h2><a class="toc-backref" href="#id5" role="doc-backlink">Cluster Models: Mathematical Overview</a><a class="headerlink" href="#cluster-models-mathematical-overview" title="Permalink to this heading">#</a></h2>
<div class="admonition-reader-suggestion admonition">
<p class="admonition-title">Reader Suggestion</p>
<p>To learn more about the various gravity theories discussed here, see the <a class="reference internal" href="gravity.html#gravity"><span class="std std-ref">Gravity Theories</span></a> page.</p>
</div>
<p>Assuming the intracluster medium of galaxy clusters can be modeled as an
ideal fluid, the momentum density <span class="math notranslate nohighlight">\(\rho{\bf v}\)</span> of the
gas obeys the Euler momentum equation (here written in conservative form
and ignoring magnetic fields, viscosity, etc.):</p>
<div class="math notranslate nohighlight">
\[\frac{\partial({\rho_g{\bf v}})}{\partial{t}} + \nabla \cdot (\rho_g{\bf v}{\bf v})
= -\nabla{P} + \rho_g{\bf g}\]</div>
<p>where <span class="math notranslate nohighlight">\(\rho_g\)</span> is the gas density, <span class="math notranslate nohighlight">\({\bf v}\)</span> is the gas velocity,
<span class="math notranslate nohighlight">\(P\)</span> is the gas pressure, and <span class="math notranslate nohighlight">\({\bf g}\)</span> is the gravitational
acceleration. The assumption of hydrostatic equilibrium implies that
<span class="math notranslate nohighlight">\({\bf v} = 0\)</span> and that all time derivatives are zero, giving:</p>
<div class="math notranslate nohighlight">
\[\nabla{P} = \rho_g{\bf g}\]</div>
<p>We therefore define the “hydrostatic vector”, <span class="math notranslate nohighlight">\(\Gamma\)</span> of the system to be</p>
<div class="math notranslate nohighlight">
\[\Gamma = -\frac{\nabla P}{\rho_g} = \nabla \Phi.\]</div>
<p>In the context of galaxy clusters, we may typically assume an ideal gas behavior for the ICM, and therefore,</p>
<div class="math notranslate nohighlight">
\[\Gamma = -\frac{\nabla P}{\rho_g} = \frac{-k_b T}{m_p \eta} \left[\frac{d\ln(\rho_g)}{dr} + \frac{d\ln(T)}{dr} \right].\]</div>
<p>As such, we recognize that from <span class="math notranslate nohighlight">\(\rho_g\)</span> and <span class="math notranslate nohighlight">\(T\)</span>, we can generally obtain the acceleration and therefore the dynamical mass
of the system. Because the dynamical mass need not be equivalent to the gasseous mass, it follows that finding the dynamical mass will also
yield the halo mass of the system.</p>
<p>It is worth noting throughout the remainder of this document that for <span class="math notranslate nohighlight">\(r\to \infty\)</span>, if <span class="math notranslate nohighlight">\(\rho \sim r^\alpha\)</span> and <span class="math notranslate nohighlight">\(T\sim r^\beta\)</span>,
then</p>
<div class="math notranslate nohighlight">
\[\Gamma \sim r^{\beta-1}.\]</div>
<p>This point becomes important as we begin discussing the interaction between the gas dynamics above and the potential of the system.</p>
<p>It is here that the theory begins to diverge dependent on the theoretical context on which the gravity of your system is
based.</p>
<section id="newtonian-gravity">
<h3><a class="toc-backref" href="#id6" role="doc-backlink">Newtonian Gravity</a><a class="headerlink" href="#newtonian-gravity" title="Permalink to this heading">#</a></h3>
<p>If the model relies on Newtonian gravity, then <span class="math notranslate nohighlight">\(\nabla \Phi = GM_{\mathrm{dyn}}(&lt;r)/r^2\)</span>, and therefore, the
dynamical mass is</p>
<div class="math notranslate nohighlight">
\[M_{\mathrm{dyn}}(&lt;r) = \frac{r^2}{G}\Gamma = \frac{-r^2 k_b T}{G m_p \eta} \left[\frac{d\ln(\rho_g)}{dr} + \frac{d\ln(T)}{dr} \right]\]</div>
<p>Thus, the dynamical mass may be directly obtained and the halo mass found by simply removing the known baryonic component. It should be noted that
for <span class="math notranslate nohighlight">\(M_{\mathrm{dyn}}(&lt;r)\)</span> to be asymptotically constant for large <span class="math notranslate nohighlight">\(r\)</span>,</p>
<div class="math notranslate nohighlight">
\[M_{\mathrm{dyn}} \sim r^2\Gamma \sim r^{\beta + 1} = r^0,\]</div>
<p>Therefore, <span class="math notranslate nohighlight">\(T \sim 1/r\)</span> for a stable dynamical mass profile at large radii.</p>
</section>
<section id="mond-gravity-aqual">
<h3><a class="toc-backref" href="#id7" role="doc-backlink">MOND Gravity: AQUAL</a><a class="headerlink" href="#mond-gravity-aqual" title="Permalink to this heading">#</a></h3>
<p>In the case of AQUAL, the mass and the acceleration are instead related by the modified Poisson equation, which implies that</p>
<div class="math notranslate nohighlight">
\[M_{\mathrm{dyn}} = \frac{r^2}{G}\mu\left(\frac{| \Gamma |}{a_0}\right)\Gamma.\]</div>
<p>Similar to the case in Newtonian dynamics, this can simply be taken directly to obtain the correct form of the dynamical mass; however, it should
be noted that the asymptotic stability conditions are not the same as in Newtonian gravity. Specifically, in the deep-MOND regime, where <span class="math notranslate nohighlight">\(\mu(x) \approx x\)</span>,</p>
<div class="math notranslate nohighlight">
\[M_{\mathrm{dyn}} \approx \frac{r^2}{G}\frac{\Gamma^2}{a_0} \sim r^2r^{2\beta-2},\]</div>
<p>and thus <span class="math notranslate nohighlight">\(\beta = 0\)</span> is required for a stable dynamical mass profile.</p>
</section>
<section id="mond-gravity-qumond">
<h3><a class="toc-backref" href="#id8" role="doc-backlink">MOND Gravity: QUMOND</a><a class="headerlink" href="#mond-gravity-qumond" title="Permalink to this heading">#</a></h3>
<p>In QUMOND, the situation is more complex. The necessary equation becomes</p>
<div class="math notranslate nohighlight">
\[\nu\left(\frac{|\nabla \Psi |}{a_0}\right)\nabla \Psi = \Gamma,\;\;\nabla \Psi = \frac{GM_{\mathrm{dyn}}}{r^2}\]</div>
<p>This form is not analytically solvable for general <span class="math notranslate nohighlight">\(\mu\)</span>; however, implicit solutions can be found numerically which provide the
dynamical mass distribution. In the DMR, <span class="math notranslate nohighlight">\(\nu(x) \to x^{-1/2}\)</span>, so</p>
<div class="math notranslate nohighlight">
\[(a_0\nabla \Psi)^{1/2} = \Gamma \implies M_{\mathrm{dyn}} \sim r^2 \Gamma^2 \sim r^{2\beta},\]</div>
<p>Thus, <span class="math notranslate nohighlight">\(T(r) \sim r^{-3}\)</span> at large radii for a stable dynamical mass profile. These results are summarized in the table below.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Gravity Type</p></th>
<th class="head"><p><span class="math notranslate nohighlight">\(\Gamma\)</span> and <span class="math notranslate nohighlight">\(\Phi\)</span> relationship</p></th>
<th class="head"><p>Mass Stability Condition</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Newtonian</p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma = \nabla \Phi = GM_{\mathrm{dyn}}(&lt;r)/r^2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(T\sim r^{-1}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>AQUAL</p></td>
<td><p><span class="math notranslate nohighlight">\(\mu\left(\frac{|\Gamma|}{a_0}\right)\Gamma = GM_{\mathrm{dyn}}(&lt;r)/r^2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(T\sim r^{0}\)</span></p></td>
</tr>
<tr class="row-even"><td><p>QUMOND</p></td>
<td><p><span class="math notranslate nohighlight">\(\Gamma = \nu\left(\frac{|\nabla \Psi|}{a_0}\right) \nabla \Psi\)</span> where
<span class="math notranslate nohighlight">\(\nabla \Psi = GM_{\mathrm{dyn}}(&lt;r)/r^2\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(T\sim r^{0}\)</span></p></td>
</tr>
</tbody>
</table>
<hr style="height:10px;background-color:black"></section>
</section>
<section id="generating-a-model-clustermodel-using-radial-profiles">
<h2><a class="toc-backref" href="#id9" role="doc-backlink">Generating a <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> Using Radial Profiles</a><a class="headerlink" href="#generating-a-model-clustermodel-using-radial-profiles" title="Permalink to this heading">#</a></h2>
<p>Based on the mathematics above, there are a variety of ways to produce <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> objects. Most of the common approaches
that see use in practice are built into the <code class="docutils literal notranslate"><span class="pre">cluster_generator</span></code> package; however, the <a class="reference internal" href="_as_gen/model.ClusterModel.from_arrays.html#model.ClusterModel.from_arrays" title="model.ClusterModel.from_arrays"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_arrays()</span></code></a> class method can
be used to generate a <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> object manually. The available generation approaches are listed as follows:</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Method</p></th>
<th class="head"><p>Function</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>From <span class="math notranslate nohighlight">\(\rho_g\)</span>
and <span class="math notranslate nohighlight">\(\rho_{\mathrm{dyn}}\)</span></p></td>
<td><p><a class="reference internal" href="_as_gen/model.ClusterModel.from_dens_and_tden.html#model.ClusterModel.from_dens_and_tden" title="model.ClusterModel.from_dens_and_tden"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_dens_and_tden()</span></code></a></p></td>
<td><p>Generates the galaxy cluster from the gas and dynamical density
profiles. Computes temperature / grav. field.</p></td>
</tr>
<tr class="row-odd"><td><p>From <span class="math notranslate nohighlight">\(\rho_g\)</span>
and <span class="math notranslate nohighlight">\(T_g\)</span></p></td>
<td><p><a class="reference internal" href="_as_gen/model.ClusterModel.from_dens_and_temp.html#model.ClusterModel.from_dens_and_temp" title="model.ClusterModel.from_dens_and_temp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_dens_and_temp()</span></code></a></p></td>
<td><p>Generates the galaxy cluster from the gas density and temperature
profiles. Computes total mass, dm, stellar etc.</p></td>
</tr>
<tr class="row-even"><td><p>From <span class="math notranslate nohighlight">\(\rho_g\)</span>
and <span class="math notranslate nohighlight">\(\rho_{\mathrm{dyn}}\)</span></p></td>
<td><p><a class="reference internal" href="_as_gen/model.ClusterModel.from_dens_and_entr.html#model.ClusterModel.from_dens_and_entr" title="model.ClusterModel.from_dens_and_entr"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_dens_and_entr()</span></code></a></p></td>
<td><p>Generates the galaxy cluster from the gas density and entropy
profiles. Computes total mass, dm, stellar etc.</p></td>
</tr>
</tbody>
</table>
<section id="clustermodel-from-gas-density-and-gas-temperature-profiles">
<h3><a class="toc-backref" href="#id10" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Gas Temperature Profiles</a><a class="headerlink" href="#clustermodel-from-gas-density-and-gas-temperature-profiles" title="Permalink to this heading">#</a></h3>
<p>The user may generate a <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> from the <a class="reference internal" href="_as_gen/model.ClusterModel.from_dens_and_temp.html#model.ClusterModel.from_dens_and_temp" title="model.ClusterModel.from_dens_and_temp"><code class="xref py py-meth docutils literal notranslate"><span class="pre">model.ClusterModel.from_dens_and_temp()</span></code></a> method, which requires <a class="reference internal" href="_as_gen/radial_profiles.RadialProfile.html#radial_profiles.RadialProfile" title="radial_profiles.RadialProfile"><code class="xref py py-class docutils literal notranslate"><span class="pre">radial_profiles.RadialProfile</span></code></a> objects
for the temperature and the gas density. Using the condition of hydrostatic equilibrium, the potential, pressure, dynamical mass, and other
necessary fields are automatically computed based on the chosen gravity theory.</p>
<p>The pressure <span class="math notranslate nohighlight">\(P(r)\)</span> is provided via the ideal gas law:</p>
<div class="math notranslate nohighlight">
\[P(r) = \frac{\rho_g(r) k_b T(r)}{m_p \eta},\]</div>
<p>where <span class="math notranslate nohighlight">\(\eta\)</span> is the mean-molecular mass (generally 0.6 for galaxy clusters).</p>
<p>Once the pressure is determined, Euler’s Equations can be used for an incompressible fluid, yielding</p>
<div class="math notranslate nohighlight">
\[\Gamma = \frac{-\nabla P(r)}{\rho_g} = \nabla \Phi\]</div>
<p>Once the potential has been determined, the corresponding gravity theory is applied to determine the dynamical mass of the system and
by extension determine the necessary halo component.</p>
<div class="math notranslate nohighlight">
\[M_{dm} = M_{\mathrm{dyn}} - M_{\mathrm{bary}}.\]</div>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Provided</p></th>
<th class="head"><p>Computed</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p><span class="math notranslate nohighlight">\(T_g\)</span>
<span class="math notranslate nohighlight">\(\rho_{g}\)</span>
<span class="math notranslate nohighlight">\(\rho_{\star}\)</span></p></td>
<td><p><span class="math notranslate nohighlight">\(\rho_{dm}, M_{dm}, M_{dyn}\)</span>
<span class="math notranslate nohighlight">\(S, \Phi, \nabla \Phi, P\)</span></p></td>
</tr>
</tbody>
</table>
</section>
<section id="clustermodel-from-gas-density-and-total-density-profiles">
<h3><a class="toc-backref" href="#id11" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Total Density Profiles</a><a class="headerlink" href="#clustermodel-from-gas-density-and-total-density-profiles" title="Permalink to this heading">#</a></h3>
<p>In the case where the dynamical density is already known, the halo mass function is trivially obtained from</p>
<div class="math notranslate nohighlight">
\[\rho_{\mathrm{halo}} = \rho_{\mathrm{dyn}} - \rho_{\mathrm{bary}},\]</div>
<p>where the baryonic component may contain a stellar distribution if the user supplies one. The difficult in this case
is to efficiently determine the temperature profile which yields HSE. Recalling that</p>
<div class="math notranslate nohighlight">
\[\Gamma = -\frac{\nabla P}{\rho_g} = \frac{-k_b T}{m_p \eta} \left[\frac{d\ln(\rho_g)}{dr} + \frac{d\ln(T)}{dr} \right].\]</div>
<p>The differential equation may be inverted, yielding</p>
<div class="math notranslate nohighlight">
\[T(r) = \frac{-m_p \eta}{k_b \rho_g} \int_{r_0}^r \rho_g(r') \nabla \Phi(r') dr' + \frac{\rho_g(r_0)}{\rho_g(r)}T(r_0).\]</div>
<p>The most efficient approach here is to take <span class="math notranslate nohighlight">\(r_0 = \infty\)</span>, in which case,</p>
<div class="math notranslate nohighlight">
\[T(r) = \frac{m_p \eta}{k_b \rho_g} \int_{r}^\infty \rho_g(r') \nabla \Phi(r') dr'.\]</div>
<p>From this, the temperature profile is obtained.</p>
</section>
<section id="clustermodel-from-gas-density-and-gas-entropy-profiles">
<h3><a class="toc-backref" href="#id12" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Gas Entropy Profiles</a><a class="headerlink" href="#clustermodel-from-gas-density-and-gas-entropy-profiles" title="Permalink to this heading">#</a></h3>
<p>Users may also generate a <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> object from an entropy profile instead of the corresponding temperature profile.
There is a 1-to-1 correspondence between entropy and temperature given that the gas density is fixed, therefore, the procedure
follows exactly from the previous section; however, the entropy is converted first to a temperature profile using the widely accepted formula</p>
<div class="math notranslate nohighlight">
\[S(r) = k_b T_g(r)n_e(r)^{-2/3}.\]</div>
</section>
<section id="clustermodel-without-gas">
<h3><a class="toc-backref" href="#id13" role="doc-backlink"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> Without Gas</a><a class="headerlink" href="#clustermodel-without-gas" title="Permalink to this heading">#</a></h3>
<p>Not all of the <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> objects are generated with a gas density profile. If one wants to produce a gas-less model,
the <a class="reference internal" href="_as_gen/model.ClusterModel.no_gas.html#model.ClusterModel.no_gas" title="model.ClusterModel.no_gas"><code class="xref py py-meth docutils literal notranslate"><span class="pre">model.ClusterModel.no_gas()</span></code></a> method is available. Users must provide a dynamical density profile, and are optionally allowed
to provide a stellar component. See the API reference for syntactical information.</p>
</section>
</section>
<section id="checking-the-hydrostatic-equilibrium">
<h2><a class="toc-backref" href="#id14" role="doc-backlink">Checking the Hydrostatic Equilibrium</a><a class="headerlink" href="#checking-the-hydrostatic-equilibrium" title="Permalink to this heading">#</a></h2>
<p>In the vast majority of cases, the aim of the <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> object is to produce a model which is in hydrostatic equilibrium. To check how successful the algorithm was in
generating a hydrostatic galaxy cluster, one can use the <a class="reference internal" href="_as_gen/model.ClusterModel.check_hse.html#model.ClusterModel.check_hse" title="model.ClusterModel.check_hse"><code class="xref py py-meth docutils literal notranslate"><span class="pre">model.ClusterModel.check_hse()</span></code></a> method, which will provide the maximal relative deviation of the system from hydrostatic equilibrium.</p>
<p>This is done by recalling that the hydrostatic equilibrium condition requires that</p>
<div class="math notranslate nohighlight">
\[-\frac{\nabla P}{\rho_g} = \nabla \Phi.\]</div>
<p>This, we define the hydrostatic variable <span class="math notranslate nohighlight">\(\xi\)</span> such that</p>
<div class="math notranslate nohighlight">
\[\xi = \frac{\nabla \Phi \rho_g + \nabla \Phi}{\nabla \Phi \rho_g}.\]</div>
<p>clearly, <span class="math notranslate nohighlight">\(\xi \approx 0\)</span> indicates a successfully equilibrated cluster.</p>
</section>
<section id="setting-a-magnetic-field-strength-profile">
<h2><a class="toc-backref" href="#id15" role="doc-backlink">Setting a Magnetic Field Strength Profile</a><a class="headerlink" href="#setting-a-magnetic-field-strength-profile" title="Permalink to this heading">#</a></h2>
<p>Magnetic fields play a major role in the dynamics of the ionized plasma modeled in hydro simulations of galaxy clusters. In <code class="docutils literal notranslate"><span class="pre">cluster_generator</span></code>, there
are currently two approaches for generating a magnetic field for a galaxy cluster.</p>
<section id="setting-a-magnetic-field-from-beta">
<h3><a class="toc-backref" href="#id16" role="doc-backlink">Setting a Magnetic Field from <span class="math notranslate nohighlight">\(\beta\)</span></a><a class="headerlink" href="#setting-a-magnetic-field-from-beta" title="Permalink to this heading">#</a></h3>
<p>Users can specify the magnetic field profile using the <a class="reference internal" href="_as_gen/model.ClusterModel.set_magnetic_field_from_beta.html#model.ClusterModel.set_magnetic_field_from_beta" title="model.ClusterModel.set_magnetic_field_from_beta"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_magnetic_field_from_beta()</span></code></a>, which allows the user
to specify the magnetic pressure factor <span class="math notranslate nohighlight">\(\beta\)</span>, which is defined such that</p>
<div class="math notranslate nohighlight">
\[\beta = \frac{p_{\mathrm{thermal}}}{p_{\mathrm{magnetic}}}.\]</div>
</section>
<section id="setting-a-magnetic-field-from-plasma-density">
<h3><a class="toc-backref" href="#id17" role="doc-backlink">Setting a Magnetic Field from plasma density</a><a class="headerlink" href="#setting-a-magnetic-field-from-plasma-density" title="Permalink to this heading">#</a></h3>
<p>Another common approach for initializing magnetic fields is to let the magnetic field be proportional to a power of the gas density. Most commonly, this value is
<span class="math notranslate nohighlight">\(\eta = \frac{2}{3}\)</span>; however, the user may specify whichever exponent they choose. To initialize a cluster with a magnetic field using this approach, use the <a class="reference internal" href="_as_gen/model.ClusterModel.set_magnetic_field_from_density.html#model.ClusterModel.set_magnetic_field_from_density" title="model.ClusterModel.set_magnetic_field_from_density"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_magnetic_field_from_density()</span></code></a>.</p>
</section>
</section>
<section id="adding-other-fields">
<h2><a class="toc-backref" href="#id18" role="doc-backlink">Adding Other Fields</a><a class="headerlink" href="#adding-other-fields" title="Permalink to this heading">#</a></h2>
<p>Users may add additional fields to the :py:class`~model.ClusterModel` instance using the <a class="reference internal" href="_as_gen/model.ClusterModel.set_field.html#model.ClusterModel.set_field" title="model.ClusterModel.set_field"><code class="xref py py-meth docutils literal notranslate"><span class="pre">set_field()</span></code></a> method, which takes a
<code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> and loads the corresponding field into the model.</p>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>User’s should be aware that <code class="docutils literal notranslate"><span class="pre">value</span></code>’s being attributed as fields must be <code class="docutils literal notranslate"><span class="pre">unyt_array</span></code>’s, not generic <code class="docutils literal notranslate"><span class="pre">list</span></code> types or <code class="docutils literal notranslate"><span class="pre">np.ndarray</span></code>. Furthermore,
the length of the value being specified must match <code class="docutils literal notranslate"><span class="pre">ClusterModel.num_elements</span></code>.</p>
</div>
</section>
<section id="reading-and-writing-model-clustermodel-objects-to-and-from-disk">
<h2><a class="toc-backref" href="#id19" role="doc-backlink">Reading and Writing <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> Objects to and from Disk</a><a class="headerlink" href="#reading-and-writing-model-clustermodel-objects-to-and-from-disk" title="Permalink to this heading">#</a></h2>
<div class="admonition-user-advice admonition">
<p class="admonition-title">User Advice</p>
<p>Generating <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> instances can be <strong>slow</strong>. As many cases as possible, it is worthwhile to
write models to disk in one of the formats discussed below so that they can be read more easily.</p>
</div>
<p>Many different protocols for writing and reading <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> instances to / from disk have been implemented. The following table summarizes the
options available; however, we advice consulting the API reference for each of the methods to get more information about specifics regarding each of the available formats.</p>
<table class="table">
<thead>
<tr class="row-odd"><th class="head"><p>Format</p></th>
<th class="head"><p>Write Method</p></th>
<th class="head"><p>Read Method</p></th>
<th class="head"><p>Notes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>ASCII</p></td>
<td><p><a class="reference internal" href="_as_gen/model.ClusterModel.write_model_to_ascii.html#model.ClusterModel.write_model_to_ascii" title="model.ClusterModel.write_model_to_ascii"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_model_to_ascii()</span></code></a></p></td>
<td><p><strong>Not Yet Implemented</strong></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-odd"><td><p>HDF5</p></td>
<td><p><a class="reference internal" href="_as_gen/model.ClusterModel.write_model_to_h5.html#model.ClusterModel.write_model_to_h5" title="model.ClusterModel.write_model_to_h5"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_model_to_h5()</span></code></a></p></td>
<td><p><a class="reference internal" href="_as_gen/model.ClusterModel.from_h5_file.html#model.ClusterModel.from_h5_file" title="model.ClusterModel.from_h5_file"><code class="xref py py-meth docutils literal notranslate"><span class="pre">from_h5_file()</span></code></a></p></td>
<td><p>None</p></td>
</tr>
<tr class="row-even"><td><p>BINARY</p></td>
<td><p><a class="reference internal" href="_as_gen/model.ClusterModel.write_model_to_binary.html#model.ClusterModel.write_model_to_binary" title="model.ClusterModel.write_model_to_binary"><code class="xref py py-meth docutils literal notranslate"><span class="pre">write_model_to_binary()</span></code></a></p></td>
<td><p><strong>Not Yet Implemented</strong></p></td>
<td><p>None</p></td>
</tr>
</tbody>
</table>
<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>In general, this approach will yield a dark matter halo component regardless of the chosen gravity theory. As such,
if the user is studying a MOND theory outside of the context of MOND + DM, this approach will not generally be viable
unless it has already been confirmed that the dynamical mass determined by the hydrostatic equilibrium condition matches
that contributed by <span class="math notranslate nohighlight">\(\rho_\star\)</span> and <span class="math notranslate nohighlight">\(\rho_g\)</span>.</p>
</div>
</section>
<section id="non-physical-systems">
<h2><a class="toc-backref" href="#id20" role="doc-backlink">Non-Physical Systems</a><a class="headerlink" href="#non-physical-systems" title="Permalink to this heading">#</a></h2>
<p>In many situations, a galaxy cluster may be <strong>mathematically</strong> constructed using pathological, incomplete, or ill-determined profiles which
create (in the case of generation from density and temperature) similarly pathological values for the resulting fields. Because the aim of <code class="docutils literal notranslate"><span class="pre">cluster_generator</span></code> is to
reasonably produce realizable galaxy cluster initial conditions, these pathological cases can interfere with the underlying mathematics used in initial condition generation
from determining particle velocities to sampling profiles. Nonetheless, <code class="docutils literal notranslate"><span class="pre">cluster_generator</span></code> will not prevent the user from generating a <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> which is non-physical.
Such <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> objects are most easily generated from temperature and density profiles, as their behavior at large and small radii has immediate implications for the
dynamical variables which are derived during generation.</p>
<p>As an example, consider the following <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> object:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="linenos"> 1</span><span class="kn">from</span> <span class="nn">cluster_generator.model</span> <span class="kn">import</span> <span class="n">ClusterModel</span>
<span class="linenos"> 2</span><span class="kn">from</span> <span class="nn">cluster_generator.radial_profiles</span> <span class="kn">import</span> <span class="n">find_overdensity_radius</span><span class="p">,</span> \
<span class="linenos"> 3</span>    <span class="n">snfw_density_profile</span><span class="p">,</span> <span class="n">snfw_total_mass</span><span class="p">,</span> <span class="n">vikhlinin_density_profile</span><span class="p">,</span> <span class="n">vikhlinin_temperature_profile</span><span class="p">,</span> \
<span class="linenos"> 4</span>    <span class="n">rescale_profile_by_mass</span><span class="p">,</span> <span class="n">find_radius_mass</span><span class="p">,</span> <span class="n">snfw_mass_profile</span>
<span class="linenos"> 5</span>
<span class="linenos"> 6</span><span class="c1"># Configuring pathological model</span>
<span class="linenos"> 7</span><span class="c1">#------------------------------------</span>
<span class="linenos"> 8</span><span class="c1"># - Parameters</span>
<span class="linenos"> 9</span><span class="n">z</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="linenos">10</span><span class="n">M200</span> <span class="o">=</span> <span class="mf">1.5e15</span>
<span class="linenos">11</span><span class="n">conc</span> <span class="o">=</span> <span class="mf">4.0</span>
<span class="linenos">12</span>
<span class="linenos">13</span><span class="c1"># - Constructing the density profile</span>
<span class="linenos">14</span><span class="n">r200</span> <span class="o">=</span> <span class="n">find_overdensity_radius</span><span class="p">(</span><span class="n">M200</span><span class="p">,</span> <span class="mf">200.0</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">)</span>
<span class="linenos">15</span><span class="n">a</span> <span class="o">=</span> <span class="n">r200</span> <span class="o">/</span> <span class="n">conc</span>
<span class="linenos">16</span><span class="n">M</span> <span class="o">=</span> <span class="n">snfw_total_mass</span><span class="p">(</span><span class="n">M200</span><span class="p">,</span> <span class="n">r200</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="linenos">17</span><span class="n">rhot</span> <span class="o">=</span> <span class="n">snfw_density_profile</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="linenos">18</span><span class="n">Mt</span> <span class="o">=</span> <span class="n">snfw_mass_profile</span><span class="p">(</span><span class="n">M</span><span class="p">,</span> <span class="n">a</span><span class="p">)</span>
<span class="linenos">19</span><span class="n">r500</span><span class="p">,</span> <span class="n">M500</span> <span class="o">=</span> <span class="n">find_radius_mass</span><span class="p">(</span><span class="n">Mt</span><span class="p">,</span> <span class="n">z</span><span class="o">=</span><span class="n">z</span><span class="p">,</span> <span class="n">delta</span><span class="o">=</span><span class="mf">500.0</span><span class="p">)</span>
<span class="linenos">20</span><span class="n">f_g</span> <span class="o">=</span> <span class="mf">0.12</span>
<span class="linenos">21</span><span class="n">rhog</span> <span class="o">=</span> <span class="n">vikhlinin_density_profile</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">,</span> <span class="n">r200</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">,</span> <span class="mf">0.67</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span>
<span class="linenos">22</span><span class="n">rhog</span> <span class="o">=</span> <span class="n">rescale_profile_by_mass</span><span class="p">(</span><span class="n">rhog</span><span class="p">,</span> <span class="n">f_g</span> <span class="o">*</span> <span class="n">M500</span><span class="p">,</span> <span class="n">r500</span><span class="p">)</span>
<span class="linenos">23</span>
<span class="linenos">24</span><span class="c1"># - Constructing the temperature profile</span>
<span class="linenos">25</span><span class="n">temp</span> <span class="o">=</span> <span class="n">vikhlinin_temperature_profile</span><span class="p">(</span><span class="mf">2.42</span><span class="p">,</span><span class="o">-</span><span class="mf">0.02</span><span class="p">,</span><span class="mf">5.00</span><span class="p">,</span><span class="mf">1.1</span><span class="p">,</span><span class="mi">350</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">19</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
<span class="linenos">26</span><span class="n">rhos</span> <span class="o">=</span> <span class="mf">0.02</span> <span class="o">*</span> <span class="n">rhot</span>
<span class="linenos">27</span><span class="n">rmin</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="linenos">28</span><span class="n">rmax</span> <span class="o">=</span> <span class="mf">10000.0</span>
<span class="linenos">29</span>
<span class="linenos">30</span><span class="c1"># - Producing the model</span>
<span class="linenos">31</span><span class="n">m</span> <span class="o">=</span> <span class="n">ClusterModel</span><span class="o">.</span><span class="n">from_dens_and_temp</span><span class="p">(</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">rhog</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span>
<span class="linenos">32</span>                                    <span class="n">stellar_density</span><span class="o">=</span><span class="n">rhos</span><span class="p">)</span>
<span class="linenos">33</span><span class="n">m</span><span class="o">.</span><span class="n">set_magnetic_field_from_beta</span><span class="p">(</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">gaussian</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<figure class="align-default" id="id2">
<img alt="_images/model/non-physical-example.png" src="_images/model/non-physical-example.png" />
<figcaption>
<p><span class="caption-text">The resulting profiles after the <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> object has been generated. Notice that
even thought the gas density and temperature profiles are reasonable, the dynamical mass and
halo mass have non-physical behaviors.</span><a class="headerlink" href="#id2" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<p><strong>What does cluster generator do about this?</strong></p>
<p>The short answer is <strong>nothing</strong>. At least, not until the user says something. All <a class="reference internal" href="_as_gen/model.ClusterModel.html#model.ClusterModel" title="model.ClusterModel"><code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code></a> instances have the
<a class="reference internal" href="_as_gen/model.ClusterModel.is_physical.html#model.ClusterModel.is_physical" title="model.ClusterModel.is_physical"><code class="xref py py-meth docutils literal notranslate"><span class="pre">model.ClusterModel.is_physical()</span></code></a> method, which will determine if the system is physical and to what radii.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m</span><span class="o">.</span><span class="n">is_physical</span><span class="p">()</span>
</pre></div>
</div>
<p>will yield.</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="w">   </span>✖<span class="w"> </span><span class="o">[</span>ClusterModel<span class="w"> </span>object<span class="p">;</span><span class="w"> </span><span class="nv">gravity</span><span class="o">=</span>Newtonian<span class="o">]</span><span class="w"> </span>is<span class="w"> </span>non-physical<span class="w"> </span>over<span class="w"> </span><span class="m">35</span>.2%<span class="w"> </span>of<span class="w"> </span>domain.

If<span class="w"> </span>the<span class="w"> </span>user<span class="w"> </span>wants<span class="w"> </span>to<span class="w"> </span>fix<span class="w"> </span>the<span class="w"> </span>system,<span class="w"> </span>they<span class="w"> </span>can<span class="w"> </span><span class="k">then</span><span class="w"> </span>call<span class="w"> </span>the<span class="w"> </span>:py:meth:<span class="sb">`</span>model.ClusterModel.rebuild_physical<span class="sb">`</span><span class="w"> </span>method,<span class="w"> </span>which<span class="w"> </span>returns<span class="w"> </span>a
</pre></div>
</div>
<p>newly constructed equivalent of the original model which is physically self-consistent.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">m2</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">rebuild_physical</span><span class="p">()</span>
<span class="n">m2</span><span class="o">.</span><span class="n">is_physical</span><span class="p">()</span>
</pre></div>
</div>
<p>which will instead yield the much more pleasant</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>✔<span class="w"> </span>ClusterModel<span class="w"> </span>object<span class="p">;</span><span class="w"> </span><span class="nv">gravity</span><span class="o">=</span>Newtonian<span class="w"> </span>is<span class="w"> </span>physical.
</pre></div>
</div>
<p>To do this, all of the density profiles are prevented from reaching 0 and then each field is recomputed with that
new, physically consistent, set of profiles.</p>
<figure class="align-default" id="id3">
<img alt="_images/model/non-physical-fixed.png" src="_images/model/non-physical-fixed.png" />
<figcaption>
<p><span class="caption-text">The result of setting <code class="docutils literal notranslate"><span class="pre">require_physical</span></code> during model generation. Here <strong>magenta</strong> is the original model without
any restriction of physical viability. The profiles for halo (dm) density, and dynamical (total) density clearly have
regions of non-physical behavior. The <strong>forest-green</strong> corresponds to <code class="docutils literal notranslate"><span class="pre">require_physical</span> <span class="pre">==</span> <span class="pre">True</span></code>, and thus removes all
of the non-physical regions of the density and mass profiles; however, leaves the temperature profile the same. Finally,
<strong>teal</strong> corresponds to <code class="docutils literal notranslate"><span class="pre">require_physical</span> <span class="pre">==</span> <span class="pre">&quot;rebuild&quot;</span></code>, which entirely recomputes the temperature profile after fixing non-physical regions.</span><a class="headerlink" href="#id3" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
</section>
</section>


                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
    <a class="left-prev"
       href="gravity.html"
       title="previous page">
      <i class="fa-solid fa-angle-left"></i>
      <div class="prev-next-info">
        <p class="prev-next-subtitle">previous</p>
        <p class="prev-next-title">Gravity Theories</p>
      </div>
    </a>
    <a class="right-next"
       href="collections.html"
       title="next page">
      <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Collections</p>
      </div>
      <i class="fa-solid fa-angle-right"></i>
    </a>
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">

  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> On this page
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cluster-models-mathematical-overview">Cluster Models: Mathematical Overview</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#newtonian-gravity">Newtonian Gravity</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mond-gravity-aqual">MOND Gravity: AQUAL</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#mond-gravity-qumond">MOND Gravity: QUMOND</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-a-model-clustermodel-using-radial-profiles">Generating a <code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code> Using Radial Profiles</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clustermodel-from-gas-density-and-gas-temperature-profiles"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Gas Temperature Profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clustermodel-from-gas-density-and-total-density-profiles"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Total Density Profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clustermodel-from-gas-density-and-gas-entropy-profiles"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> from Gas Density and Gas Entropy Profiles</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#clustermodel-without-gas"><code class="docutils literal notranslate"><span class="pre">ClusterModel</span></code> Without Gas</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#checking-the-hydrostatic-equilibrium">Checking the Hydrostatic Equilibrium</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-a-magnetic-field-strength-profile">Setting a Magnetic Field Strength Profile</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-a-magnetic-field-from-beta">Setting a Magnetic Field from <span class="math notranslate nohighlight">\(\beta\)</span></a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#setting-a-magnetic-field-from-plasma-density">Setting a Magnetic Field from plasma density</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#adding-other-fields">Adding Other Fields</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#reading-and-writing-model-clustermodel-objects-to-and-from-disk">Reading and Writing <code class="xref py py-class docutils literal notranslate"><span class="pre">model.ClusterModel</span></code> Objects to and from Disk</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#non-physical-systems">Non-Physical Systems</a></li>
</ul>
  </nav></div>

  <div class="sidebar-secondary-item">
  <div class="tocsection sourcelink">
    <a href="_sources/models.rst.txt">
      <i class="fa-solid fa-file-lines"></i> Show Source
    </a>
  </div>
</div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2020, John ZuHone and Eliza DIggins.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>