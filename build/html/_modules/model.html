
<!DOCTYPE html>


<html lang="en" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>model &#8212; cluster_generator  documentation</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "light";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=e353d410970836974a52" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=e353d410970836974a52" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.1.2/css/all.min.css?digest=e353d410970836974a52" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.1.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=fd506691" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=e353d410970836974a52" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52" />

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js?v=ccbe24c1"></script>
    <script src="../_static/doctools.js?v=888ff710"></script>
    <script src="../_static/sphinx_highlight.js?v=4825356b"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="https://unpkg.com/mermaid@10.2.0/dist/mermaid.min.js"></script>
    <script>mermaid.initialize({startOnLoad:true});</script>
    <script>DOCUMENTATION_OPTIONS.pagename = '_modules/model';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <a class="skip-link" href="#main-content">Skip to main content</a>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__primary"
          id="__primary"/>
  <label class="overlay overlay-primary" for="__primary"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          name="__secondary"
          id="__secondary"/>
  <label class="overlay overlay-secondary" for="__secondary"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search the docs ..."
         aria-label="Search the docs ..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>
  
    <nav class="bd-header navbar navbar-expand-lg bd-navbar">
<div class="bd-header__inner bd-page-width">
  <label class="sidebar-toggle primary-toggle" for="__primary">
    <span class="fa-solid fa-bars"></span>
  </label>
  
  <div class="navbar-header-items__start">
    
      <div class="navbar-item">
  

<a class="navbar-brand logo" href="../index.html">
  
  
  
  
  
    <p class="title logo__title">cluster_generator  documentation</p>
  
</a></div>
    
  </div>
  
  
  <div class="col-lg-9 navbar-header-items">
    
    <div class="me-auto navbar-header-items__center">
      
        <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Getting_Started.html">
                        Quickstart Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../gravity.html">
                        Gravity Theories
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../models.html">
                        Cluster Models
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../collections.html">
                        Collections
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples.html">
                        Examples
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
      
    </div>
    
    
    <div class="navbar-header-items__end">
      
        <div class="navbar-item navbar-persistent--container">
          
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
        </div>
      
      
        <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
      
    </div>
    
  </div>
  
  
    <div class="navbar-persistent--mobile">
<script>
document.write(`
  <button class="btn btn-sm navbar-btn search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>
`);
</script>
    </div>
  

  
</div>

    </nav>
  
  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      <div class="bd-sidebar-primary bd-sidebar hide-on-wide">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
      <div class="sidebar-header-items__center">
        
          <div class="navbar-item"><nav class="navbar-nav">
  <p class="sidebar-header-items__title"
     role="heading"
     aria-level="1"
     aria-label="Site Navigation">
    Site Navigation
  </p>
  <ul class="bd-navbar-elements navbar-nav">
    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../Getting_Started.html">
                        Quickstart Guide
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../gravity.html">
                        Gravity Theories
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../models.html">
                        Cluster Models
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../collections.html">
                        Collections
                      </a>
                    </li>
                

                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../examples.html">
                        Examples
                      </a>
                    </li>
                
            <div class="nav-item dropdown">
                <button class="btn dropdown-toggle nav-item" type="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                    More
                </button>
                <div class="dropdown-menu">
                    
                    <li class="nav-item">
                      <a class="nav-link nav-internal" href="../api.html">
                        API
                      </a>
                    </li>
                
                </div>
            </div>
            
  </ul>
</nav></div>
        
      </div>
    
    
    
      <div class="sidebar-header-items__end">
        
          <div class="navbar-item">
<script>
document.write(`
  <button class="theme-switch-button btn btn-sm btn-outline-primary navbar-btn rounded-circle" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="theme-switch" data-mode="light"><i class="fa-solid fa-sun"></i></span>
    <span class="theme-switch" data-mode="dark"><i class="fa-solid fa-moon"></i></span>
    <span class="theme-switch" data-mode="auto"><i class="fa-solid fa-circle-half-stroke"></i></span>
  </button>
`);
</script></div>
        
      </div>
    
  </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main">
        
        
          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item">



<nav aria-label="Breadcrumbs">
  <ul class="bd-breadcrumbs" role="navigation" aria-label="Breadcrumb">
    
    <li class="breadcrumb-item breadcrumb-home">
      <a href="../index.html" class="nav-link" aria-label="Home">
        <i class="fa-solid fa-home"></i>
      </a>
    </li>
    
    <li class="breadcrumb-item"><a href="index.html" class="nav-link">Module code</a></li>
    
    <li class="breadcrumb-item active" aria-current="page">model</li>
  </ul>
</nav>
</div>
      
    </div>
  
  
</div>
</div>
              
              
              
                
<div id="searchbox"></div>
                <article class="bd-article" role="main">
                  
  <h1>Source code for model</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Galaxy Cluster Models</span>
<span class="sd">=====================</span>
<span class="sd">Similar to the :py:class:`gravity.Potential` class, the :py:class:`model.ClusterModel` class is the ``cluster_generator`` code&#39;s</span>
<span class="sd">base object for fully realized models of galaxy clusters. These objects contain fields (``ClusterModel.fields``) just as the :py:class:`gravity.Potential` objects do;</span>
<span class="sd">however, :py:class:`model.ClusterModel` objects can be virialized, may have particles generated from them, and can have HSE checked.</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">OrderedDict</span>

<span class="kn">import</span> <span class="nn">astropy</span>
<span class="kn">import</span> <span class="nn">astropy.units</span>
<span class="kn">import</span> <span class="nn">h5py</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">halo</span> <span class="kn">import</span> <span class="n">Halo</span>
<span class="kn">from</span> <span class="nn">scipy.integrate</span> <span class="kn">import</span> <span class="n">cumtrapz</span><span class="p">,</span> <span class="n">quad</span>
<span class="kn">from</span> <span class="nn">scipy.interpolate</span> <span class="kn">import</span> <span class="n">InterpolatedUnivariateSpline</span>
<span class="kn">from</span> <span class="nn">unyt</span> <span class="kn">import</span> <span class="n">unyt_array</span>

<span class="kn">from</span> <span class="nn">cluster_generator.gravity</span> <span class="kn">import</span> <span class="n">available_gravities</span>
<span class="kn">from</span> <span class="nn">cluster_generator.particles</span> <span class="kn">import</span> \
    <span class="n">ClusterParticles</span>
<span class="kn">from</span> <span class="nn">cluster_generator.utils</span> <span class="kn">import</span> \
    <span class="n">integrate</span><span class="p">,</span> <span class="n">mylog</span><span class="p">,</span> <span class="n">integrate_mass</span><span class="p">,</span> \
    <span class="n">mp</span><span class="p">,</span> <span class="n">generate_particle_radii</span><span class="p">,</span> <span class="n">mu</span><span class="p">,</span> <span class="n">mue</span><span class="p">,</span> \
    <span class="n">ensure_ytquantity</span><span class="p">,</span> <span class="n">kpc_to_cm</span><span class="p">,</span> <span class="n">log_string</span><span class="p">,</span> <span class="n">devLogger</span><span class="p">,</span><span class="n">eprint</span>
<span class="kn">from</span> <span class="nn">cluster_generator.virial</span> <span class="kn">import</span> \
    <span class="n">VirialEquilibrium</span>

<span class="n">tt</span> <span class="o">=</span> <span class="mf">2.0</span> <span class="o">/</span> <span class="mf">3.0</span>
<span class="n">mtt</span> <span class="o">=</span> <span class="o">-</span><span class="n">tt</span>
<span class="n">ft</span> <span class="o">=</span> <span class="mf">5.0</span> <span class="o">/</span> <span class="mf">3.0</span>
<span class="n">tf</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">/</span> <span class="mf">5.0</span>
<span class="n">mtf</span> <span class="o">=</span> <span class="o">-</span><span class="n">tf</span>
<span class="n">gamma</span> <span class="o">=</span> <span class="n">ft</span>
<span class="n">et</span> <span class="o">=</span> <span class="mf">8.0</span> <span class="o">/</span> <span class="mf">3.0</span>
<span class="n">te</span> <span class="o">=</span> <span class="mf">3.0</span> <span class="o">/</span> <span class="mf">8.0</span>


<div class="viewcode-block" id="ClusterModel"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.html#model.ClusterModel">[docs]</a><span class="k">class</span> <span class="nc">ClusterModel</span><span class="p">:</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    The :py:class:`model.ClusterModel` class is a comprehensive representation of the cluster being modeled and can be used to generate</span>
<span class="sd">    accurate initial conditions. The class is predicated on a fixed number of sample radii in the cluster.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    num_elements: int</span>
<span class="sd">        The number of elements included. This is equivalent to the number of radii at which the model is sampled.</span>
<span class="sd">    fields: dict[str,unyt_array]</span>
<span class="sd">        The fields to attribute to the :py:class:`model.ClusterModel`.</span>
<span class="sd">    gravity: str or :py:class:`gravity.Gravity`</span>
<span class="sd">        The gravity theory to apply. Options are ``[Newtonian,AQUAL,QUMOND]``.</span>
<span class="sd">    **kwargs:</span>
<span class="sd">        Additional kwargs to pass through to the object. These become incorporated in the ``self.attrs`` dictionary.</span>

<span class="sd">    Notes</span>
<span class="sd">    -----</span>

<span class="sd">    - ``__getitem__`` and ``__contains__`` are aliased down to ``self.fields``. There is no ``__setitem__``, so index</span>
<span class="sd">      / key assignment cannot be done. use ``ClusterModel.set_field()`` instead.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1">#  Class Variables</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------------------- #</span>
    <span class="c1">#: The default included fields that can be accessed.</span>
    <span class="n">default_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">,</span> <span class="s2">&quot;pressure&quot;</span><span class="p">,</span> <span class="s2">&quot;total_density&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;gravitational_potential&quot;</span><span class="p">,</span> <span class="s2">&quot;gravitational_field&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;total_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;gas_mass&quot;</span><span class="p">,</span> <span class="s2">&quot;dark_matter_mass&quot;</span><span class="p">,</span>
                      <span class="s2">&quot;dark_matter_density&quot;</span><span class="p">,</span> <span class="s2">&quot;stellar_density&quot;</span><span class="p">,</span> <span class="s2">&quot;stellar_mass&quot;</span><span class="p">]</span>

    <span class="n">_keep_units</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;entropy&quot;</span><span class="p">,</span> <span class="s2">&quot;electron_number_density&quot;</span><span class="p">,</span>
                   <span class="s2">&quot;magnetic_field_strength&quot;</span><span class="p">]</span>

    <span class="c1"># -- Virialization variables -- #</span>
    <span class="n">_dm_virial</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">_star_virial</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="c1">#  Dunder Methods</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------------------- #</span>
<div class="viewcode-block" id="ClusterModel.__init__"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.__init__.html#model.ClusterModel.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="s2">&quot;Newtonian&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#  Setting basic attributes</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="c1"># - Initializing base attributes - #</span>
        <span class="c1">#: The ``fields`` associated with the ``Potential`` object.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="o">=</span> <span class="n">fields</span>

        <span class="c1"># - managing gravity initialization - #</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gravity</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="c1"># Gravity comes in as string, we try to look it up</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="n">available_gravities</span><span class="p">[</span><span class="n">gravity</span><span class="p">](</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The gravity option </span><span class="si">{</span><span class="n">gravity</span><span class="si">}</span><span class="s2"> doesn&#39;t exist. Configured options are </span><span class="si">{</span><span class="n">available_gravities</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">any</span><span class="p">([</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">gravity</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">available_gravities</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="c1"># The gravity passed in is already a gravity object.</span>
            <span class="k">if</span> <span class="n">gravity</span><span class="o">.</span><span class="n">model</span> <span class="o">!=</span> <span class="bp">self</span><span class="p">:</span>
                <span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;Tried to assign </span><span class="si">{</span><span class="n">gravity</span><span class="si">}</span><span class="s2"> object to model but it was already assigned. Generating fresh instance.&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="n">gravity</span><span class="o">.</span><span class="vm">__class__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">elif</span> <span class="nb">any</span><span class="p">([</span><span class="n">gravity</span> <span class="ow">is</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">available_gravities</span><span class="o">.</span><span class="n">values</span><span class="p">()]):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span> <span class="o">=</span> <span class="n">gravity</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;The entity passed as gravity is not a recognized type for this parameter.&quot;</span><span class="p">)</span>

        <span class="c1">#  Determining derived attributes</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="c1">#: The number of elements in each ``field`` array.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="s2">&quot;gravitational_potential&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gravitational_potential&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1">#: Additional attributes associated with the object. Derived from ``**kwargs``.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span> <span class="o">=</span> <span class="n">kwargs</span>

        <span class="c1">#  Managing additional parameters</span>
        <span class="c1"># ----------------------------------------------------------------------------------------------------------------- #</span>
        <span class="c1"># - setting the require_physical kwarg</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="s2">&quot;virialization_method&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">:</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;ClusterModel [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">] has no virialization method. Setting to default = </span><span class="si">{</span><span class="p">(</span><span class="s1">&#39;eddington&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="o">.</span><span class="n">_classname</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s1">&#39;Newtonian&#39;</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;lma&#39;</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;virialization_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;eddington&quot;</span> <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="o">.</span><span class="n">_classname</span> <span class="o">==</span> <span class="s2">&quot;Newtonian&quot;</span> <span class="k">else</span> <span class="s2">&quot;lma&quot;</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ClusterModel object; gravity=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="o">.</span><span class="n">_classname</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;ClusterModel object; gravity=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="o">.</span><span class="n">_classname</span><span class="si">}</span><span class="s2">, fields=</span><span class="si">{</span><span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">item</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span>

    <span class="k">def</span> <span class="fm">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">item</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">item</span><span class="p">]</span>

    <span class="k">def</span> <span class="fm">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1">#  Properties</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------------------- #</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">pot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The potential of the :py:class:`model.ClusterModel` object.&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="o">.</span><span class="n">is_calculated</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gravitational_potential&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="o">.</span><span class="n">potential</span><span class="p">()</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gravitational_potential&quot;</span><span class="p">]</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">dm_virial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dm_virial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_dm_virial</span> <span class="o">=</span> <span class="n">VirialEquilibrium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;dark_matter&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">virialization_method</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_dm_virial</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">star_virial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_star_virial</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="s2">&quot;stellar_density&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_star_virial</span> <span class="o">=</span> <span class="n">VirialEquilibrium</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;stellar&quot;</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">virialization_method</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_star_virial</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">virialization_method</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;The virialization method&quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;virialization_method&quot;</span><span class="p">]</span>

    <span class="nd">@virialization_method</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">virialization_method</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;virialization_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>

    <span class="c1">#  Class Methods</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------------------- #</span>
<div class="viewcode-block" id="ClusterModel.from_arrays"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.from_arrays.html#model.ClusterModel.from_arrays">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_arrays</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initialize the :py:class:`model.ClusterModel` from ``fields`` alone.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        fields: dict[str:unyt_array]</span>
<span class="sd">            The fields from which to generate the model.</span>

<span class="sd">            .. admonition:: development note</span>

<span class="sd">                The ``fields`` parameter must be self consistent in its definition, and must contain a ``radius`` key, from</span>
<span class="sd">                which the class assesses the number of elements.</span>
<span class="sd">        kwargs:</span>
<span class="sd">            Additional values to pass to the initialization method. This should include the gravity type and any attributes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ClusterModel</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        - Equivalent to ``ClusterModel(fields[&quot;radius&quot;].size,fields)``.</span>

<span class="sd">        See Also</span>
<span class="sd">        --------</span>

<span class="sd">        :py:meth:`~model.ClusterModel.from_dens_and_tden`,:py:meth:`~model.ClusterModel.from_dens_and_temp`,:py:meth:`~model.ClusterModel.from_dens_and_entr`,:py:meth:`~model.ClusterModel.from_h5_file`</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>

<span class="sd">        .. code_block:: python</span>

<span class="sd">            from cluster_generator.tests.utils import generate_mdr_potential</span>
<span class="sd">            import matplotlib.pyplot as plt</span>
<span class="sd">            import pytest</span>
<span class="sd">            mdr = getfixture(&quot;generate_mdr_potential&quot;)</span>
<span class="sd">            m,d,r = mdr</span>
<span class="sd">            fields = {&quot;total_mass&quot;:m,&quot;total_density&quot;:d,&quot;radius&quot;:r}</span>
<span class="sd">            model = ClusterModel.from_arrays(fields)</span>
<span class="sd">            print(model.fields.keys())</span>

<span class="sd">            _ = model.pot # Generate the potential</span>
<span class="sd">            model.plot(&quot;gravitational_potential&quot;)</span>

<span class="sd">        .. image:: ../_images/model/from_arrays_plot.png</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="s2">&quot;stellar_density&quot;</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;stellar_density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stellar_density&quot;</span><span class="p">]</span>
            <span class="k">del</span> <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;stellar_density&quot;</span><span class="p">]</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.from_h5_file"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.from_h5_file.html#model.ClusterModel.from_h5_file">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_h5_file</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">r_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes a :py:class:`model.ClusterModel` instance from HDF5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        filename : string</span>
<span class="sd">            The name of the file to read the model from.</span>
<span class="sd">        r_min: float, optional</span>
<span class="sd">            The minimum radius</span>
<span class="sd">        r_max: float, optional</span>
<span class="sd">            The maximal radius</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        .. attention::</span>

<span class="sd">            The :py:meth:`model.ClusterModel.from_h5_file` method will seek both ``filename`` and ``filename.pkl``. If</span>
<span class="sd">            the later cannot be found, the :py:class:`model.ClusterModel` will lose its attributes and issue a warning.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">dill</span> <span class="k">as</span> <span class="nn">pickle</span>
        <span class="kn">from</span> <span class="nn">cluster_generator.virial</span> <span class="kn">import</span> <span class="n">VirialEquilibrium</span>

        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Loading ClusterModel instance from </span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="c1"># Preloading the correct fields from the HDF5 file</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="k">with</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="s2">&quot;r&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">fnames</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">f</span><span class="p">[</span><span class="s1">&#39;fields&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
            <span class="n">get_dm_virial</span> <span class="o">=</span> <span class="s1">&#39;dm_df&#39;</span> <span class="ow">in</span> <span class="n">f</span>
            <span class="n">get_star_virial</span> <span class="o">=</span> <span class="s1">&#39;star_df&#39;</span> <span class="ow">in</span> <span class="n">f</span>

        <span class="c1">#  Building attributes</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">_atr_path</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">filename</span><span class="si">}</span><span class="s2">.pkl&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">_atr_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fpkl</span><span class="p">:</span>
                <span class="n">attrs</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fpkl</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">FileNotFoundError</span><span class="p">:</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to load attribute file </span><span class="si">{</span><span class="n">_atr_path</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
            <span class="n">attrs</span> <span class="o">=</span> <span class="p">{}</span>

        <span class="c1">#  Building fields</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>  <span class="c1"># -&gt; converting fields to unyt_arrays.</span>
            <span class="n">a</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="o">.</span><span class="n">from_hdf5</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="n">field</span><span class="p">,</span>
                                     <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">units</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_keep_units</span><span class="p">:</span>  <span class="c1"># --&gt; using data conversion.</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_base</span><span class="p">(</span><span class="s2">&quot;galactic&quot;</span><span class="p">)</span>

        <span class="c1"># - Determining rmin / rmax and masking. -#</span>
        <span class="k">if</span> <span class="n">r_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_min</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">r_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_max</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">r_min</span><span class="p">,</span>
                              <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="n">r_max</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">fnames</span><span class="p">:</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">num_elements</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>

        <span class="c1">#  Cleanup</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="k">if</span> <span class="s2">&quot;gravity&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;gravity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;Newtonian&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="s2">&quot;virialization_method&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">attrs</span><span class="p">:</span>
            <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;virialization_method&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;lma&quot;</span> <span class="k">if</span> <span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;gravity&quot;</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;Newtonian&quot;</span> <span class="k">else</span> <span class="s2">&quot;eddington&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="c1"># - Creating the model - #</span>
        <span class="n">model</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="o">**</span><span class="n">attrs</span><span class="p">)</span>

        <span class="c1"># - Virializing -#</span>
        <span class="k">if</span> <span class="n">get_dm_virial</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">r_min</span><span class="p">,</span>
                                  <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="n">r_max</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="o">.</span><span class="n">from_hdf5</span><span class="p">(</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;dm_df&quot;</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>

            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ptype&quot;</span><span class="p">:</span> <span class="s2">&quot;dark_matter&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;df&quot;</span> <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">virialization_method</span> <span class="o">==</span> <span class="s2">&quot;eddington&quot;</span> <span class="k">else</span> <span class="s2">&quot;sigma2&quot;</span><span class="p">):</span> <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">virialization_method</span><span class="p">}</span>

            <span class="n">model</span><span class="o">.</span><span class="n">_dm_virial</span> <span class="o">=</span> <span class="n">VirialEquilibrium</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">get_star_virial</span><span class="p">:</span>
            <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">r_min</span><span class="p">,</span>
                                  <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="n">r_max</span><span class="p">)</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="o">.</span><span class="n">from_hdf5</span><span class="p">(</span>
                <span class="n">filename</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;star_df&quot;</span><span class="p">)[</span><span class="n">mask</span><span class="p">]</span>

            <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ptype&quot;</span><span class="p">:</span> <span class="s2">&quot;stellar&quot;</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;df&quot;</span> <span class="k">if</span> <span class="n">model</span><span class="o">.</span><span class="n">virialization_method</span> <span class="o">==</span> <span class="s2">&quot;eddington&quot;</span> <span class="k">else</span> <span class="s2">&quot;sigma2&quot;</span><span class="p">):</span> <span class="n">df</span><span class="p">,</span> <span class="s2">&quot;type&quot;</span><span class="p">:</span> <span class="n">model</span><span class="o">.</span><span class="n">virialization_method</span><span class="p">}</span>

            <span class="n">model</span><span class="o">.</span><span class="n">_star_virial</span> <span class="o">=</span> <span class="n">VirialEquilibrium</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">model</span></div>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">_from_scratch</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">stellar_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="s2">&quot;Newtonian&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1">#  Sanity check</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Constructing ClusterModel. Method=&#39;from_scratch&#39;.&quot;</span><span class="p">)</span>

        <span class="n">_required_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">,</span> <span class="s2">&quot;total_density&quot;</span><span class="p">,</span> <span class="s2">&quot;total_mass&quot;</span><span class="p">]</span>

        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="n">_required_fields</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">field</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Failed to find required field </span><span class="si">{</span><span class="n">field</span><span class="si">}</span><span class="s2"> for generation using _from_scratch.&quot;</span><span class="p">)</span>

        <span class="c1">#  Pulling data</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span>

        <span class="c1"># Standardizing Construction</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Checking for missing mass / density fields...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[from_scratch]] Checking for missing mass / density fields.&quot;</span><span class="p">)</span>
        <span class="c1"># - Gas mass integration -#</span>
        <span class="k">if</span> <span class="s2">&quot;density&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="ow">and</span> <span class="s2">&quot;gas_mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[from_scratch]] Integrating gas mass profile.&quot;</span><span class="p">)</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
                <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cumtrapz</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">rr</span> <span class="o">*</span> <span class="n">rr</span><span class="p">,</span>
                                               <span class="n">x</span><span class="o">=</span><span class="n">rr</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">m0</span><span class="p">,</span> <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>

        <span class="c1"># - Managing the stellar component</span>
        <span class="k">if</span> <span class="n">stellar_density</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[from_scratch]] Integrating stellar mass profile.&quot;</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;stellar_density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">stellar_density</span><span class="p">(</span><span class="n">rr</span><span class="p">),</span>
                                                   <span class="s2">&quot;Msun/kpc**3&quot;</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;stellar_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
                <span class="n">integrate_mass</span><span class="p">(</span><span class="n">stellar_density</span><span class="p">,</span> <span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;[DONE]&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">frmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">)</span>
        <span class="c1">#  Managing the halo mass component</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="k">if</span> <span class="s2">&quot;dark_matter_density&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[from_scratch]] Determining the halo component.&quot;</span><span class="p">)</span>
            <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Determining the halo component...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
            <span class="n">ddm</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="k">if</span> <span class="s2">&quot;density&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">ddm</span> <span class="o">-=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span>
            <span class="k">if</span> <span class="s2">&quot;stellar_mass&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                <span class="n">ddm</span> <span class="o">-=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;stellar_density&quot;</span><span class="p">]</span>

            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;dark_matter_density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ddm</span>
            <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;[DONE]&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">frmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Halo component manually specified.&quot;</span><span class="p">)</span>

        <span class="c1"># -- Computing the dark matter mass -- #</span>
        <span class="k">if</span> <span class="s2">&quot;dark_matter_mass&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[from_scratch]] Integrating halo density.&quot;</span><span class="p">)</span>
            <span class="n">m0</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;dark_matter_density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">rr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;dark_matter_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
                <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cumtrapz</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;dark_matter_density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">rr</span> <span class="o">*</span> <span class="n">rr</span><span class="p">,</span>
                                               <span class="n">x</span><span class="o">=</span><span class="n">rr</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">m0</span><span class="p">,</span> <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>

        <span class="c1">#  Computing subsidiary fields</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Computing additional fields...&quot;</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="s2">&quot;density&quot;</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[from_scratch]] Computing g_fraction, n_e, S.&quot;</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas_fraction&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas_mass&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;electron_number_density&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;cm**-3&quot;</span><span class="p">,</span> <span class="s2">&quot;number_density&quot;</span><span class="p">,</span> <span class="n">mu</span><span class="o">=</span><span class="n">mue</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;entropy&quot;</span><span class="p">]</span> <span class="o">=</span> \
                <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;electron_number_density&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="n">mtt</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;[DONE]&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">frmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Initializing the ClusterModel...&quot;</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_scratch&quot;</span><span class="p">)</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1">#  Computing the potential</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">pot</span>
        <span class="k">return</span> <span class="n">obj</span>

<div class="viewcode-block" id="ClusterModel.from_dens_and_temp"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.from_dens_and_temp.html#model.ClusterModel.from_dens_and_temp">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dens_and_temp</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span>
                           <span class="n">stellar_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="s2">&quot;Newtonian&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Computes the :py:class:`model.ClusterModel` from gas density and temperature.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rmin: float</span>
<span class="sd">            The minimum radius at which to compute</span>
<span class="sd">        rmax: float</span>
<span class="sd">            The maximum radius at which to compute.</span>
<span class="sd">        num_points: int</span>
<span class="sd">            The number of points to sample form.</span>
<span class="sd">        density: callable</span>
<span class="sd">            The gas density profile.</span>
<span class="sd">        temperature: callable</span>
<span class="sd">            The gas temperature profile.</span>

<span class="sd">            .. warning::</span>

<span class="sd">                The temperature profile must be in units of ``keV``.</span>

<span class="sd">        stellar_density: callable or unyt_array</span>
<span class="sd">            The stellar density profile.</span>
<span class="sd">        gravity: str</span>
<span class="sd">            The gravity type to use.</span>
<span class="sd">        **kwargs:</span>
<span class="sd">            Additional kwargs to pass through to the object. These become incorporated in the ``self.attrs`` dictionary.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ClusterModel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#  Logging and Setup</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Constructing ClusterModel. Method=&#39;from_dens_and_temp&#39;, gravity=</span><span class="si">{</span><span class="n">gravity</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Constructing ClusterModel. Method=&#39;from_dens_and_temp&#39;, gravity=</span><span class="si">{</span><span class="n">gravity</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
        <span class="c1"># -- Sanity Check: make sure gravity is real -- #</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">gravity</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">gravity</span> <span class="o">=</span> <span class="n">available_gravities</span><span class="p">[</span><span class="n">gravity</span><span class="p">]</span>
            <span class="k">except</span> <span class="ne">KeyError</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;The gravity option </span><span class="si">{</span><span class="n">gravity</span><span class="si">}</span><span class="s2"> doesn&#39;t exist. Configured options are </span><span class="si">{</span><span class="n">available_gravities</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">gravity</span> <span class="o">=</span> <span class="n">gravity</span><span class="o">.</span><span class="vm">__class__</span>

        <span class="c1"># -- Setting up arrays -- #</span>
        <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[dens/temp]] Constructing r, rho_g, T from profiles.&quot;</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Computing r, rho_g, T from profiles...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmax</span><span class="p">),</span> <span class="n">num_points</span><span class="p">,</span><span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="s2">&quot;kpc&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;Msun/kpc**3&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">temperature</span><span class="p">(</span><span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;keV&quot;</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;[DONE]&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">frmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>

        <span class="c1">#  Carrying out computations</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="c1"># -- Pressure -- #</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Computing calculating the pressure...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span> <span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>
        <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[dens/temp]] Constructing pressure...&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">])</span> <span class="o">/</span> <span class="p">(</span><span class="n">mu</span> <span class="o">*</span> <span class="n">mp</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s2">&quot;Msun/(Myr**2*kpc)&quot;</span><span class="p">)</span>
        <span class="n">pressure_spline</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;[DONE]&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">frmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>

        <span class="c1"># -- Field -- #</span>
        <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[dens/temp]] Constructing gravitational field.&quot;</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Computing the field...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>
        <span class="n">dPdr</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">pressure_spline</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Msun/(Myr**2*kpc**2)&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gravitational_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dPdr</span> <span class="o">/</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gravitational_field&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s2">&quot;kpc/Myr**2&quot;</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;[DONE]&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">frmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>

        <span class="c1"># -- masses (integration) -- #</span>
        <span class="n">devLogger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;[[dens/temp]] Constructing mass fields and density.&quot;</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Computing the mass and density fields...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">end</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">integrate_mass</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">gravity</span><span class="o">.</span><span class="n">compute_mass</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">total_mass_spline</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span>
                                                         <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="n">dMdr</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">total_mass_spline</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="n">nu</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Msun/kpc&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">dMdr</span> <span class="o">/</span> <span class="p">(</span><span class="mf">4.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;[DONE]&quot;</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">frmt</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>

        <span class="c1"># -- sanity check warning: looking for non-physical systems -- #</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
            <span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;The model being generated has non-physical attributes.&quot;</span><span class="p">)</span>

        <span class="n">eprint</span><span class="p">(</span><span class="s2">&quot;Passing to `from_scratch`...&quot;</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="n">location</span><span class="o">=</span><span class="s2">&quot;from_dens_and_temp&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_scratch</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">stellar_density</span><span class="o">=</span><span class="n">stellar_density</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span>
                                 <span class="n">profiles</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;density&quot;</span>        <span class="p">:</span> <span class="n">density</span><span class="p">,</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
                                           <span class="s2">&quot;stellar_density&quot;</span><span class="p">:</span> <span class="n">stellar_density</span><span class="p">},</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.from_dens_and_entr"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.from_dens_and_entr.html#model.ClusterModel.from_dens_and_entr">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dens_and_entr</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">entropy</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span>
                           <span class="n">stellar_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="s2">&quot;Newtonian&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct the model from density and entropy.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rmin: float</span>
<span class="sd">            The minimum radius at which to compute</span>
<span class="sd">        rmax: float</span>
<span class="sd">            The maximum radius at which to compute.</span>
<span class="sd">        num_points: int</span>
<span class="sd">            The number of sample points.</span>
<span class="sd">        density: callable</span>
<span class="sd">            The gas density profile.</span>
<span class="sd">        entropy: callable</span>
<span class="sd">            The gas entropy profile.</span>

<span class="sd">        stellar_density: callable or unyt_array</span>
<span class="sd">            The stellar density profile.</span>
<span class="sd">        gravity: str</span>
<span class="sd">            The gravity type to use.</span>
<span class="sd">        attrs: dict</span>
<span class="sd">            Additional attributes to pass to :py:class:`model.ClusterModel`. See documentation for more details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ClusterModel</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">n_e</span> <span class="o">=</span> <span class="n">density</span> <span class="o">/</span> <span class="p">(</span><span class="n">mue</span> <span class="o">*</span> <span class="n">mp</span> <span class="o">*</span> <span class="n">kpc_to_cm</span> <span class="o">**</span> <span class="mi">3</span><span class="p">)</span>
        <span class="n">temperature</span> <span class="o">=</span> <span class="n">entropy</span> <span class="o">*</span> <span class="n">n_e</span> <span class="o">**</span> <span class="n">tt</span>
        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_dens_and_temp</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">num_points</span><span class="p">,</span>
                                      <span class="n">stellar_density</span><span class="o">=</span><span class="n">stellar_density</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span> <span class="n">profiles</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;density&quot;</span>        <span class="p">:</span> <span class="n">density</span><span class="p">,</span>
                                                                                                  <span class="s2">&quot;temperature&quot;</span>    <span class="p">:</span> <span class="n">temperature</span><span class="p">,</span>
                                                                                                  <span class="s2">&quot;stellar_density&quot;</span><span class="p">:</span> <span class="n">stellar_density</span><span class="p">,</span>
                                                                                                  <span class="s2">&quot;entropy&quot;</span>        <span class="p">:</span> <span class="n">entropy</span><span class="p">}</span>
                                      <span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.from_dens_and_tden"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.from_dens_and_tden.html#model.ClusterModel.from_dens_and_tden">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">from_dens_and_tden</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">density</span><span class="p">,</span> <span class="n">total_density</span><span class="p">,</span>
                           <span class="n">stellar_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">num_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="s2">&quot;Newtonian&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Construct a hydrostatic equilibrium model using gas density</span>
<span class="sd">        and total density profiles</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rmin : float</span>
<span class="sd">            Minimum radius of profiles in kpc.</span>
<span class="sd">        rmax : float</span>
<span class="sd">            Maximum radius of profiles in kpc.</span>
<span class="sd">        density : :class:`~cluster_generator.radial_profiles.RadialProfile`</span>
<span class="sd">            A radial profile describing the gas mass density.</span>
<span class="sd">        total_density : :class:`~cluster_generator.radial_profiles.RadialProfile`</span>
<span class="sd">            A radial profile describing the total mass density.</span>
<span class="sd">        stellar_density : :class:`~cluster_generator.radial_profiles.RadialProfile`, optional</span>
<span class="sd">            A radial profile describing the stellar mass density, if desired.</span>
<span class="sd">        num_points : integer, optional</span>
<span class="sd">            The number of points the profiles are evaluated at.</span>
<span class="sd">        attrs: dict</span>
<span class="sd">            Additional attributes to pass to :py:class:`model.ClusterModel`. See documentation for more details.</span>
<span class="sd">        gravity: str</span>
<span class="sd">            The gravity theory to use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Computing the profiles from density and total density. Gravity=</span><span class="si">{</span><span class="n">gravity</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="c1">#  Pulling necessary field data to begin computations</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmax</span><span class="p">),</span> <span class="n">num_points</span><span class="p">,</span>
                         <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="s2">&quot;kpc&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">density</span><span class="p">(</span><span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;Msun/kpc**3&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">total_density</span><span class="p">(</span><span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;Msun/kpc**3&quot;</span><span class="p">)</span>

        <span class="c1"># -- beginning the mass integrations -- #</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Integrating total mass profile.&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">integrate_mass</span><span class="p">(</span><span class="n">total_density</span><span class="p">,</span> <span class="n">rr</span><span class="p">),</span>
                                          <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">integrate_mass</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>

        <span class="c1"># - Generating the output object - #</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">stellar_density</span><span class="o">=</span><span class="n">stellar_density</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># - Getting the potential - #</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">pot</span>
        <span class="n">_potential_spine</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">pot</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;kpc**2/Myr**2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;gravitational_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="o">-</span><span class="n">_potential_spine</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kpc/Myr**2&quot;</span><span class="p">)</span>

        <span class="c1"># - Computing temperature - #</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;gravitational_field&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s2">&quot;kpc/Myr**2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span>
        <span class="n">g_r</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>
        <span class="n">dPdr_int</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Integrating pressure profile.&quot;</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="o">-</span><span class="n">integrate</span><span class="p">(</span><span class="n">dPdr_int</span><span class="p">,</span> <span class="n">rr</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dPdr_int2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">density</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">rr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">P</span> <span class="o">-=</span> <span class="n">quad</span><span class="p">(</span><span class="n">dPdr_int2</span><span class="p">,</span> <span class="n">rr</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="s2">&quot;Msun/kpc/Myr**2&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">mp</span> <span class="o">/</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s2">&quot;keV&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_scratch</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">stellar_density</span><span class="o">=</span><span class="n">stellar_density</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span> <span class="o">**</span><span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span>
                                 <span class="n">profiles</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;density&quot;</span>        <span class="p">:</span> <span class="n">density</span><span class="p">,</span>
                                           <span class="s2">&quot;total_density&quot;</span>  <span class="p">:</span> <span class="n">total_density</span><span class="p">,</span>
                                           <span class="s2">&quot;stellar_density&quot;</span><span class="p">:</span> <span class="n">stellar_density</span><span class="p">,</span>
                                           <span class="p">})</span></div>

<div class="viewcode-block" id="ClusterModel.no_gas"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.no_gas.html#model.ClusterModel.no_gas">[docs]</a>    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">no_gas</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">,</span> <span class="n">total_density</span><span class="p">,</span> <span class="n">stellar_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
               <span class="n">num_points</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="s2">&quot;Newtonian&quot;</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the cluster without gas.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        rmin : float</span>
<span class="sd">            Minimum radius of profiles in kpc.</span>
<span class="sd">        rmax : float</span>
<span class="sd">            Maximum radius of profiles in kpc.</span>
<span class="sd">        total_density : :class:`~cluster_generator.radial_profiles.RadialProfile`</span>
<span class="sd">            A radial profile describing the total mass density.</span>
<span class="sd">        stellar_density : :class:`~cluster_generator.radial_profiles.RadialProfile`, optional</span>
<span class="sd">            A radial profile describing the stellar mass density, if desired.</span>
<span class="sd">        num_points : integer, optional</span>
<span class="sd">            The number of points the profiles are evaluated at.</span>
<span class="sd">        gravity: str</span>
<span class="sd">            The gravity theory to use</span>
<span class="sd">        attrs: dict</span>
<span class="sd">            Additional attributes to pass to :py:class:`model.ClusterModel`. See documentation for more details.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        ClusterModel</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">rr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmin</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">log10</span><span class="p">(</span><span class="n">rmax</span><span class="p">),</span> <span class="n">num_points</span><span class="p">,</span>
                         <span class="n">endpoint</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="s2">&quot;kpc&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">total_density</span><span class="p">(</span><span class="n">rr</span><span class="p">),</span> <span class="s2">&quot;Msun/kpc**3&quot;</span><span class="p">)</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Integrating total mass profile.&quot;</span><span class="p">)</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">integrate_mass</span><span class="p">(</span><span class="n">total_density</span><span class="p">,</span> <span class="n">rr</span><span class="p">),</span>
                                          <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="bp">cls</span><span class="o">.</span><span class="n">_from_scratch</span><span class="p">(</span><span class="n">fields</span><span class="p">,</span> <span class="n">stellar_density</span><span class="o">=</span><span class="n">stellar_density</span><span class="p">,</span> <span class="n">gravity</span><span class="o">=</span><span class="n">gravity</span><span class="p">,</span> <span class="n">attrs</span><span class="o">=</span><span class="n">attrs</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>

    <span class="c1">#  Methods</span>
    <span class="c1"># ----------------------------------------------------------------------------------------------------------------- #</span>
<div class="viewcode-block" id="ClusterModel.keys"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.keys.html#model.ClusterModel.keys">[docs]</a>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span></div>

<div class="viewcode-block" id="ClusterModel.is_physical"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.is_physical.html#model.ClusterModel.is_physical">[docs]</a>    <span class="k">def</span> <span class="nf">is_physical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if the :py:class:`model.ClusterModel` instance is physically viable.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        status: bool</span>
<span class="sd">            ``True`` if the :py:class:`model.ClusterModel` instance is physical.</span>
<span class="sd">        domain: unyt_array</span>
<span class="sd">            ``None`` if ``status=True``, otherwise returns an array of all radii at which non-physicality occurs.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">with</span> <span class="n">Halo</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">log_string</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Checking physicality of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">),</span> <span class="n">spinner</span><span class="o">=</span><span class="s2">&quot;dots&quot;</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                  <span class="n">animation</span><span class="o">=</span><span class="s2">&quot;marquee&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
            <span class="n">_phys_check_fields</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;dark_matter_density&quot;</span><span class="p">,</span> <span class="s2">&quot;stellar_density&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">,</span> <span class="s2">&quot;total_density&quot;</span><span class="p">]</span>

            <span class="n">non_phys_radii</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

            <span class="c1"># -- Check 1: non-neg -- #</span>
            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">_phys_check_fields</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">non_phys_radii</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="c1"># -- Check 2: satisfactory sum -- #</span>
            <span class="n">_sum_field</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>

            <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">_phys_check_fields</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
                <span class="k">if</span> <span class="n">f</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">f</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">_sum_field</span> <span class="o">+=</span> <span class="bp">self</span><span class="p">[</span><span class="n">f</span><span class="p">]</span><span class="o">.</span><span class="n">d</span>

            <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">_sum_field</span> <span class="o">-</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span>
            <span class="n">non_phys_radii</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">diff</span> <span class="o">&gt;</span> <span class="mf">1e-7</span><span class="p">)]</span> <span class="o">=</span> <span class="mi">1</span>

            <span class="n">status</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">non_phys_radii</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">status</span><span class="p">:</span>
                <span class="n">h</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2"> is physical.&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">h</span><span class="o">.</span><span class="n">fail</span><span class="p">(</span>
                    <span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">] is non-physical over </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="mi">100</span><span class="w"> </span><span class="o">*</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">non_phys_radii</span><span class="p">[</span><span class="n">non_phys_radii</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="p">])</span><span class="w"> </span><span class="o">/</span><span class="w"> </span><span class="nb">len</span><span class="p">(</span><span class="n">non_phys_radii</span><span class="p">),</span><span class="w"> </span><span class="n">decimals</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span><span class="si">}</span><span class="s2">% of domain.&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">non_phys_radii</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)]</span></div>

<div class="viewcode-block" id="ClusterModel.set_rmax"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.set_rmax.html#model.ClusterModel.set_rmax">[docs]</a>    <span class="k">def</span> <span class="nf">set_rmax</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">r_max</span><span class="p">):</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="n">r_max</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">field</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">field</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span>
        <span class="n">num_elements</span> <span class="o">=</span> <span class="n">mask</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">ClusterModel</span><span class="p">(</span><span class="n">num_elements</span><span class="p">,</span> <span class="n">fields</span><span class="p">,</span> <span class="n">dm_virial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">dm_virial</span><span class="p">,</span>
                            <span class="n">star_virial</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">star_virial</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.write_model_to_ascii"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.write_model_to_ascii.html#model.ClusterModel.write_model_to_ascii">[docs]</a>    <span class="k">def</span> <span class="nf">write_model_to_ascii</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">,</span> <span class="n">in_cgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the equilibrium model to an ascii text file. Uses</span>
<span class="sd">        AstroPy&#39;s `QTable` to write the file, so that units are</span>
<span class="sd">        included.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_filename : string</span>
<span class="sd">            The file to write the model to.</span>
<span class="sd">        in_cgs : boolean, optional</span>
<span class="sd">            Whether to convert the units to cgs before writing. Default: False.</span>
<span class="sd">        overwrite : boolean, optional</span>
<span class="sd">            Overwrite an existing file with the same name. Default: False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # - Imports - #</span>
<span class="sd">        &gt;&gt;&gt; from cluster_generator.tests.utils import generate_model</span>
<span class="sd">        &gt;&gt;&gt; import tempfile</span>
<span class="sd">        &gt;&gt;&gt; # Generating the model #</span>
<span class="sd">        &gt;&gt;&gt; mdl = generate_model(gravity=&quot;Newtonian&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with tempfile.TemporaryDirectory() as temp_dir:</span>
<span class="sd">        ...     mdl.write_model_to_ascii(os.path.join(temp_dir,&quot;model.h5&quot;),overwrite=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">astropy.table</span> <span class="kn">import</span> <span class="n">QTable</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">in_cgs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">to_equivalent</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;thermal&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_units</span><span class="p">:</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="o">.</span><span class="n">in_cgs</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span>

            <span class="c1"># - Checking for dimension issues - #</span>
            <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">fd</span><span class="o">.</span><span class="n">units</span><span class="p">)</span> <span class="o">==</span> <span class="s2">&quot;dimensionless&quot;</span><span class="p">:</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">astropy</span><span class="o">.</span><span class="n">units</span><span class="o">.</span><span class="n">dimensionless_unscaled</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fields</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">=</span> <span class="n">fd</span><span class="o">.</span><span class="n">to_astropy</span><span class="p">()</span>
        <span class="n">t</span> <span class="o">=</span> <span class="n">QTable</span><span class="p">(</span><span class="n">fields</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_model_attrs</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">in_cgs</span><span class="o">=</span><span class="n">in_cgs</span><span class="p">)</span>

        <span class="n">t</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="n">overwrite</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.write_model_to_h5"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.write_model_to_h5.html#model.ClusterModel.write_model_to_h5">[docs]</a>    <span class="k">def</span> <span class="nf">write_model_to_h5</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">,</span> <span class="n">in_cgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">r_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                          <span class="n">r_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Write the equilibrium model to an HDF5 file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_filename : string</span>
<span class="sd">            The file to write the model to.</span>
<span class="sd">        in_cgs : boolean, optional</span>
<span class="sd">            Whether to convert the units to cgs before writing. Default False.</span>
<span class="sd">        overwrite : boolean, optional</span>
<span class="sd">            Overwrite an existing file with the same name. Default False.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # - Imports - #</span>
<span class="sd">        &gt;&gt;&gt; from cluster_generator.tests.utils import generate_model</span>
<span class="sd">        &gt;&gt;&gt; import tempfile</span>
<span class="sd">        &gt;&gt;&gt; # Generating the model #</span>
<span class="sd">        &gt;&gt;&gt; mdl = generate_model(gravity=&quot;Newtonian&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with tempfile.TemporaryDirectory() as temp_dir:</span>
<span class="sd">        ...     mdl.write_model_to_h5(os.path.join(temp_dir,&quot;model.h5&quot;),overwrite=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#  Sanity checks</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_filename</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot create </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">. It exists and &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;overwrite=False.&quot;</span><span class="p">)</span>

        <span class="c1">#  Building the file</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">f</span> <span class="o">=</span> <span class="n">h5py</span><span class="o">.</span><span class="n">File</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">create_dataset</span><span class="p">(</span><span class="s2">&quot;num_elements&quot;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span><span class="p">)</span>
        <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

        <span class="c1">#  Writing Data</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_model_attrs</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">in_cgs</span><span class="o">=</span><span class="n">in_cgs</span><span class="p">)</span>

        <span class="c1"># -- managing r_min / r_max -- #</span>
        <span class="k">if</span> <span class="n">r_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_min</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">r_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">r_min</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="n">r_max</span><span class="p">)</span>

        <span class="c1"># -- setting fields -- #</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="k">if</span> <span class="n">in_cgs</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">to_equivalent</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;thermal&quot;</span><span class="p">)</span>
                <span class="k">elif</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_units</span><span class="p">:</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">in_cgs</span><span class="p">()</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
            <span class="n">fd</span><span class="o">.</span><span class="n">write_hdf5</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="n">k</span><span class="p">,</span>
                          <span class="n">group_name</span><span class="o">=</span><span class="s2">&quot;fields&quot;</span><span class="p">)</span>

        <span class="c1">#  Manage the virialization properties</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_dm_virial&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">virialization_method</span> <span class="o">==</span> <span class="s2">&quot;eddington&quot;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_virial</span><span class="o">.</span><span class="n">df</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_virial</span><span class="o">.</span><span class="n">sigma</span>
            <span class="n">df</span><span class="o">.</span><span class="n">write_hdf5</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;dm_df&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_star_virial&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">):</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">virialization_method</span> <span class="o">==</span> <span class="s2">&quot;eddington&quot;</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_virial</span><span class="o">.</span><span class="n">df</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_virial</span><span class="o">.</span><span class="n">sigma</span>
            <span class="n">df</span><span class="o">.</span><span class="n">write_hdf5</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">dataset_name</span><span class="o">=</span><span class="s2">&quot;star_df&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.write_model_to_binary"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.write_model_to_binary.html#model.ClusterModel.write_model_to_binary">[docs]</a>    <span class="k">def</span> <span class="nf">write_model_to_binary</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">,</span> <span class="n">fields_to_write</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">in_cgs</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">r_min</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                              <span class="n">overwrite</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        writes the model to unformatted Fortran binary.</span>

<span class="sd">        .. attention::</span>

<span class="sd">            But why would you want Fortan binary??</span>

<span class="sd">        .. warning::</span>

<span class="sd">            This proceedure will lose all of the metadata from the ``self.gravity`` attribute and the ``self.attrs``</span>
<span class="sd">            dictionary. As such, this should only be used in cases where the user can specify those properties manually</span>
<span class="sd">            upon reopening the file.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        output_filename: str</span>
<span class="sd">            The output filename.</span>
<span class="sd">        fields_to_write: list</span>
<span class="sd">            The list of field names to write.</span>
<span class="sd">        in_cgs: bool</span>
<span class="sd">            If ``True``, will write in cgs.</span>
<span class="sd">        r_min: float</span>
<span class="sd">            The minimum radius</span>
<span class="sd">        r_max: float</span>
<span class="sd">            The maximum radius</span>
<span class="sd">        overwrite: bool</span>
<span class="sd">            ``True`` will overwrite any existing file with the same path.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # - Imports - #</span>
<span class="sd">        &gt;&gt;&gt; from cluster_generator.tests.utils import generate_model</span>
<span class="sd">        &gt;&gt;&gt; import tempfile</span>
<span class="sd">        &gt;&gt;&gt; # Generating the model #</span>
<span class="sd">        &gt;&gt;&gt; mdl = generate_model(gravity=&quot;Newtonian&quot;)</span>
<span class="sd">        &gt;&gt;&gt; with tempfile.TemporaryDirectory() as temp_dir:</span>
<span class="sd">        ...     mdl.write_model_to_binary(os.path.join(temp_dir,&quot;model.h5&quot;),overwrite=True)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">fields_to_write</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fields_to_write</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
        <span class="kn">from</span> <span class="nn">scipy.io</span> <span class="kn">import</span> <span class="n">FortranFile</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">output_filename</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">overwrite</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">IOError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Cannot create </span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">. It exists and &quot;</span>
                          <span class="sa">f</span><span class="s2">&quot;overwrite=False.&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">r_min</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_min</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">if</span> <span class="n">r_max</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r_max</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="mi">2</span>
        <span class="n">mask</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&gt;=</span> <span class="n">r_min</span><span class="p">,</span>
                              <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">&lt;=</span> <span class="n">r_max</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_write_model_attrs</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="n">in_cgs</span><span class="o">=</span><span class="n">in_cgs</span><span class="p">)</span>

        <span class="k">with</span> <span class="n">FortranFile</span><span class="p">(</span><span class="n">output_filename</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write_record</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">][</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">size</span><span class="p">)</span>
            <span class="n">prof_rec</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">fields_to_write</span><span class="p">:</span>
                <span class="n">v</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">in_cgs</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">k</span> <span class="o">==</span> <span class="s2">&quot;temperature&quot;</span><span class="p">:</span>
                        <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">to_equivalent</span><span class="p">(</span><span class="s2">&quot;K&quot;</span><span class="p">,</span> <span class="s2">&quot;thermal&quot;</span><span class="p">)</span>
                    <span class="k">elif</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_keep_units</span><span class="p">:</span>
                        <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span><span class="o">.</span><span class="n">in_cgs</span><span class="p">()</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">fd</span> <span class="o">=</span> <span class="n">v</span><span class="p">[</span><span class="n">mask</span><span class="p">]</span>
                <span class="n">prof_rec</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
            <span class="n">f</span><span class="o">.</span><span class="n">write_record</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">prof_rec</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="p">)</span></div>

    <span class="k">def</span> <span class="nf">_write_model_attrs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">output_filename</span><span class="p">,</span> <span class="n">in_cgs</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;writes the model attributes to file.&quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">dill</span> <span class="k">as</span> <span class="nn">pickle</span>

        <span class="c1"># -- Managing the attributes -- #</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;unit_system&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;cgs&quot;</span> <span class="k">if</span> <span class="n">in_cgs</span> <span class="k">else</span> <span class="s2">&quot;galactic&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;gravity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="o">.</span><span class="n">_classname</span>

        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">output_filename</span><span class="si">}</span><span class="s2">.pkl&quot;</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">atf</span><span class="p">:</span>
            <span class="n">pickle</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">,</span> <span class="n">atf</span><span class="p">)</span>

<div class="viewcode-block" id="ClusterModel.set_field"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.set_field.html#model.ClusterModel.set_field">[docs]</a>    <span class="k">def</span> <span class="nf">set_field</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a field with name `name` to value `value`, which is an `unyt_array`.</span>
<span class="sd">        The array will be checked to make sure that it has the appropriate size.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">unyt_array</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s2">&quot;value needs to be an unyt_array&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="o">.</span><span class="n">size</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="n">mylog</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Overwriting field </span><span class="si">%s</span><span class="s2">.&quot;</span> <span class="o">%</span> <span class="n">name</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The length of the array needs to be &quot;</span>
                             <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">num_elements</span><span class="si">}</span><span class="s2"> elements!&quot;</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.find_field_at_radius"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.find_field_at_radius.html#model.ClusterModel.find_field_at_radius">[docs]</a>    <span class="k">def</span> <span class="nf">find_field_at_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">r</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Find the value of a *field* in the profiles</span>
<span class="sd">        at radius *r*.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="n">field</span><span class="p">]),</span>
                          <span class="bp">self</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.check_hse"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.check_hse.html#model.ClusterModel.check_hse">[docs]</a>    <span class="k">def</span> <span class="nf">check_hse</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Determine the deviation of the model from hydrostatic equilibrium.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        chk : NumPy array</span>
<span class="sd">            An array containing the relative deviation from hydrostatic</span>
<span class="sd">            equilibrium as a function of radius.</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>
<span class="sd">        Recall that the hydrostatic vector :math:`\Gamma` is defined such that</span>

<span class="sd">        .. math::</span>

<span class="sd">            \Gamma = -\frac{\nabla P}{\rho_g} = \nabla \Phi,</span>

<span class="sd">        Thus, in hydrostatic equilibrium, :math:`\nabla P + \nabla \Phi \rho_g = 0`. To produce a scale invariant quantity, we instead</span>
<span class="sd">        report</span>

<span class="sd">        .. math::</span>

<span class="sd">            \alpha = \frac{\nabla P + \nabla \Phi \rho_g}{\nabla \Phi \rho_g}.</span>

<span class="sd">        Examples</span>
<span class="sd">        --------</span>
<span class="sd">        &gt;&gt;&gt; # - Imports - #</span>
<span class="sd">        &gt;&gt;&gt; from cluster_generator.tests.utils import generate_model</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from numpy.testing import assert_almost_equal</span>
<span class="sd">        &gt;&gt;&gt; # Generating the model #</span>
<span class="sd">        &gt;&gt;&gt; mdl = generate_model(gravity=&quot;Newtonian&quot;)</span>
<span class="sd">        &gt;&gt;&gt; # Checking HSE</span>
<span class="sd">        &gt;&gt;&gt; assert_almost_equal(np.amax(mdl.check_hse().d),0,decimal=3)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1">#  Sanity Check</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="k">if</span> <span class="s2">&quot;pressure&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;This ClusterModel contains no gas!&quot;</span><span class="p">)</span>
        <span class="c1">#  Pulling necessary fields</span>
        <span class="c1"># ----------------------------------------------------------------------------------------------------------------- #</span>
        <span class="n">rr</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">v</span>
        <span class="n">pressure_spline</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span>
            <span class="n">rr</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">)</span>
        <span class="n">dPdx</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">pressure_spline</span><span class="p">(</span><span class="n">rr</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="s2">&quot;Msun/(Myr**2*kpc**2)&quot;</span><span class="p">)</span>
        <span class="n">rhog</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gravitational_field&quot;</span><span class="p">]</span>
        <span class="n">chk</span> <span class="o">=</span> <span class="n">dPdx</span> <span class="o">-</span> <span class="n">rhog</span>
        <span class="n">chk</span> <span class="o">/=</span> <span class="n">rhog</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;The maximum relative deviation of this profile from &quot;</span>
                   <span class="s2">&quot;hydrostatic equilibrium is </span><span class="si">%g</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">chk</span><span class="p">)</span><span class="o">.</span><span class="n">max</span><span class="p">())</span>
        <span class="k">return</span> <span class="n">chk</span></div>

<div class="viewcode-block" id="ClusterModel.rebuild_physical"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.rebuild_physical.html#model.ClusterModel.rebuild_physical">[docs]</a>    <span class="k">def</span> <span class="nf">rebuild_physical</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The :py:meth:`model.ClusterModel.rebuild_physical` method can be used to convert the instance calling the method into a</span>
<span class="sd">        physically well constrained version of itself. See the Notes for the procedure used to accomplish this.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>

<span class="sd">        Notes</span>
<span class="sd">        -----</span>

<span class="sd">        Method</span>
<span class="sd">        ++++++</span>
<span class="sd">        The general approach used here is that for any of the density profiles in the :py:class:`model.ClusterModel` instance, if :math:`\rho_i &lt; 0`, the profile will be non-physical. Therefore,</span>
<span class="sd">        we make the generic substitution :math:`\rho _i \to 0, \;\;\text{when}\;\; \rho_i &lt; 0`.</span>

<span class="sd">        All of the dependent quantities (Temperature, entropy, gravitational field, etc.) must be recomputed after the initial stage of fixing the density profiles. To do so, we recompute the the temperature manually and then</span>
<span class="sd">        re-initialize the new system using the corrected density and temperature profiles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">copy</span> <span class="kn">import</span> <span class="n">deepcopy</span>
        <span class="kn">from</span> <span class="nn">cluster_generator.utils</span> <span class="kn">import</span> <span class="n">truncate_spline</span>
        <span class="c1">#  Making the profile corrections</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="k">with</span> <span class="n">Halo</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="n">log_string</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Rebuilding </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2"> for physicality...&quot;</span><span class="p">),</span> <span class="n">spinner</span><span class="o">=</span><span class="s2">&quot;dots&quot;</span><span class="p">,</span>
                  <span class="n">stream</span><span class="o">=</span><span class="n">sys</span><span class="o">.</span><span class="n">stderr</span><span class="p">,</span>
                  <span class="n">animation</span><span class="o">=</span><span class="s2">&quot;marquee&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">h</span><span class="p">:</span>
            <span class="c1">#  Sanity Check</span>
            <span class="c1"># -------------------------------------------------------------------------------------------------------- #</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">is_physical</span><span class="p">()[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">h</span><span class="o">.</span><span class="n">succeed</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">] is already physical.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            
            <span class="c1"># Copying fields</span>
            <span class="c1">#----------------------------------------------------------------------------------------------------------#</span>
            <span class="n">fields</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">)</span>
            <span class="c1">#  Rebuilding the constituent density arrays</span>
            <span class="c1"># -------------------------------------------------------------------------------------------------------- #</span>
            <span class="n">_required_fields_fixable</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;stellar_&quot;</span>    <span class="p">:</span> <span class="s2">&quot;stellar_&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;dark_matter_&quot;</span><span class="p">:</span> <span class="s2">&quot;dark_matter_&quot;</span><span class="p">,</span>
                                        <span class="s2">&quot;&quot;</span>            <span class="p">:</span> <span class="s2">&quot;gas_&quot;</span><span class="p">}</span>

            <span class="c1"># - Resetting the total densities and masses - #</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">])),</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">])),</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

            <span class="c1"># - Fixing -#</span>
            <span class="k">for</span> <span class="n">fd</span><span class="p">,</span> <span class="n">fm</span> <span class="ow">in</span> <span class="n">_required_fields_fixable</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="c1">#  Attempting to fix the density</span>
                <span class="c1"># ---------------------------------------------------------------------------------------------------- #</span>
                <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[[rebuild-physical]]: fixing </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density.&quot;</span><span class="p">)</span>

                <span class="c1"># -- SANITY CHECK -- #</span>
                <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
                    <span class="k">continue</span>

                <span class="c1"># -- APPLYING THE FIX -- #</span>

                <span class="c1"># - fixing the density by replacing with zero - #</span>
                <span class="n">_tmp</span> <span class="o">=</span> <span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
                <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">][</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">v</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">)]</span> <span class="o">=</span> <span class="mf">1e-10</span>  <span class="c1"># reset to 0.</span>

                <span class="k">if</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">all</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">equal</span><span class="p">(</span><span class="n">_tmp</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">])):</span>
                    <span class="n">mylog</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;[[rebuild-physical]]: Rebuild required: </span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density.&quot;</span><span class="p">)</span>

                    <span class="c1"># - smoothing the array - #</span>
                    <span class="n">sp</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
                    <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">sp</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">),</span> <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">units</span><span class="p">)</span>

                    <span class="c1"># - fixing the mass profiles - #</span>
                    <span class="c1">#</span>
                    <span class="c1"># Because we want to smooth the fixed density profiles, we are best off just re-integrating all</span>
                    <span class="c1"># of the mass profiles instead of trying to perform array manipulations on them.</span>
                    <span class="n">m0</span> <span class="o">=</span> <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">*</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">**</span> <span class="mi">3</span>
                    <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fm</span><span class="si">}</span><span class="s2">mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
                        <span class="p">(</span><span class="mf">4.0</span> <span class="o">/</span> <span class="mf">3.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">cumtrapz</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span> <span class="o">*</span> <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                                                       <span class="n">x</span><span class="o">=</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">initial</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span> <span class="o">+</span> <span class="n">m0</span><span class="p">,</span> <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>

                <span class="c1"># -- Adding to total mass -- #</span>
                <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_density&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fd</span><span class="si">}</span><span class="s2">density&quot;</span><span class="p">]</span>
                <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;total_mass&quot;</span><span class="p">]</span> <span class="o">+=</span> <span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">fm</span><span class="si">}</span><span class="s2">mass&quot;</span><span class="p">]</span>

        <span class="c1">#  Recomputing temperature field from new system</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>

        <span class="c1"># - Sanity Check - #</span>
        <span class="k">if</span> <span class="s2">&quot;density&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">fields</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;The system [</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span><span class="si">}</span><span class="s2">] has no `density` field. If it is non-physical, it is likely a product of user error and should be corrected manually.&quot;</span><span class="p">)</span>

        <span class="c1"># - Regenerating the base object for potential comptation - #</span>
        <span class="n">obj</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">from_arrays</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">fields</span><span class="p">),</span> <span class="n">stellar_density</span><span class="o">=</span><span class="p">(</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;stellar_density&quot;</span><span class="p">]</span> <span class="k">if</span> <span class="s2">&quot;stellar_density&quot;</span> <span class="ow">in</span> <span class="n">fields</span> <span class="k">else</span> <span class="kc">None</span><span class="p">),</span> <span class="n">gravity</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">gravity</span><span class="p">,</span> <span class="o">**</span><span class="bp">self</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span>

        <span class="c1"># - Getting the potential - #</span>
        <span class="n">_</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">pot</span>
        <span class="n">_potential_spine</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">obj</span><span class="o">.</span><span class="n">pot</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="s2">&quot;kpc**2/Myr**2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
        <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;gravitational_field&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="o">-</span><span class="n">_potential_spine</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">units</span><span class="o">=</span><span class="s2">&quot;kpc/Myr**2&quot;</span><span class="p">)</span>

        <span class="c1"># - Computing temperature - #</span>
        <span class="n">g</span> <span class="o">=</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;gravitational_field&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">in_units</span><span class="p">(</span><span class="s2">&quot;kpc/Myr**2&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">v</span>
        <span class="n">g_r</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">g</span><span class="p">)</span>

        <span class="c1"># -- Managing the density profile -- #</span>
        <span class="k">if</span> <span class="s2">&quot;profiles&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span> <span class="ow">and</span> <span class="p">(</span><span class="s2">&quot;density&quot;</span> <span class="ow">in</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;profiles&quot;</span><span class="p">]):</span>
            <span class="n">dens_func</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">[</span><span class="s2">&quot;profiles&quot;</span><span class="p">][</span><span class="s2">&quot;density&quot;</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">_dens_func</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">)</span>
            <span class="n">dens_func</span> <span class="o">=</span> <span class="n">truncate_spline</span><span class="p">(</span><span class="n">_dens_func</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>

        <span class="n">dPdr_int</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">dens_func</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">g_r</span><span class="p">(</span><span class="n">r</span><span class="p">)</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Integrating pressure profile.&quot;</span><span class="p">)</span>
        <span class="n">P</span> <span class="o">=</span> <span class="o">-</span><span class="n">integrate</span><span class="p">(</span><span class="n">dPdr_int</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">dPdr_int2</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">r</span><span class="p">:</span> <span class="n">dens_func</span><span class="p">(</span><span class="n">r</span><span class="p">)</span> <span class="o">*</span> <span class="n">g</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="n">r</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span>
        <span class="n">P</span> <span class="o">-=</span> <span class="n">quad</span><span class="p">(</span><span class="n">dPdr_int2</span><span class="p">,</span> <span class="n">obj</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">np</span><span class="o">.</span><span class="n">inf</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">100</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">P</span><span class="p">,</span> <span class="s2">&quot;Msun/kpc/Myr**2&quot;</span><span class="p">)</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">obj</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">*</span> <span class="n">mu</span> <span class="o">*</span> <span class="n">mp</span> <span class="o">/</span> <span class="n">obj</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span>
        <span class="n">obj</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;temperature&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s2">&quot;keV&quot;</span><span class="p">)</span>

        <span class="n">h</span><span class="o">.</span><span class="n">succeed</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="n">_from_scratch</span><span class="p">(</span><span class="n">deepcopy</span><span class="p">(</span><span class="n">obj</span><span class="o">.</span><span class="n">fields</span><span class="p">),</span>
                                            <span class="n">stellar_density</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                            <span class="n">gravity</span><span class="o">=</span><span class="n">obj</span><span class="o">.</span><span class="n">gravity</span><span class="p">,</span>
                                            <span class="o">**</span><span class="n">obj</span><span class="o">.</span><span class="n">attrs</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.check_dm_virial"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.check_dm_virial.html#model.ClusterModel.check_dm_virial">[docs]</a>    <span class="k">def</span> <span class="nf">check_dm_virial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_virial</span><span class="o">.</span><span class="n">check_virial</span><span class="p">()</span></div>

<div class="viewcode-block" id="ClusterModel.check_star_virial"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.check_star_virial.html#model.ClusterModel.check_star_virial">[docs]</a>    <span class="k">def</span> <span class="nf">check_star_virial</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_star_virial</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">RuntimeError</span><span class="p">(</span><span class="s2">&quot;Cannot check the virial equilibrium of &quot;</span>
                               <span class="s2">&quot;the stars because there are no stars in &quot;</span>
                               <span class="s2">&quot;this model!&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_virial</span><span class="o">.</span><span class="n">check_virial</span><span class="p">()</span></div>

<div class="viewcode-block" id="ClusterModel.set_magnetic_field_from_beta"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.set_magnetic_field_from_beta.html#model.ClusterModel.set_magnetic_field_from_beta">[docs]</a>    <span class="k">def</span> <span class="nf">set_magnetic_field_from_beta</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">beta</span><span class="p">,</span> <span class="n">gaussian</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a magnetic field radial profile from</span>
<span class="sd">        a plasma beta parameter, assuming beta = p_th/p_B.</span>
<span class="sd">        The field can be set in Gaussian or Lorentz-Heaviside</span>
<span class="sd">        (dimensionless) units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        beta : float</span>
<span class="sd">            The ratio of the thermal pressure to the</span>
<span class="sd">            magnetic pressure.</span>
<span class="sd">        gaussian : boolean, optional</span>
<span class="sd">            Set the field in Gaussian units such that</span>
<span class="sd">            p_B = B^2/(8*pi), otherwise p_B = B^2/2.</span>
<span class="sd">            Default: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">2.0</span> <span class="o">*</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="n">beta</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">gaussian</span><span class="p">:</span>
            <span class="n">B</span> <span class="o">*=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="n">B</span><span class="o">.</span><span class="n">convert_to_units</span><span class="p">(</span><span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;magnetic_field_strength&quot;</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.set_magnetic_field_from_density"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.set_magnetic_field_from_density.html#model.ClusterModel.set_magnetic_field_from_density">[docs]</a>    <span class="k">def</span> <span class="nf">set_magnetic_field_from_density</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">B0</span><span class="p">,</span> <span class="n">eta</span><span class="o">=</span><span class="mf">2.</span> <span class="o">/</span> <span class="mf">3.</span><span class="p">,</span> <span class="n">gaussian</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set a magnetic field radial profile assuming it is proportional</span>
<span class="sd">        to some power of the density, usually 2/3. The field can be set</span>
<span class="sd">        in Gaussian or Lorentz-Heaviside (dimensionless) units.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        B0 : float</span>
<span class="sd">            The central magnetic field strength in units of</span>
<span class="sd">            gauss. </span>
<span class="sd">        eta : float, optional</span>
<span class="sd">            The power of the density which the field is </span>
<span class="sd">            proportional to. Default: 2/3.</span>
<span class="sd">        gaussian : boolean, optional</span>
<span class="sd">            Set the field in Gaussian units such that</span>
<span class="sd">            p_B = B^2/(8*pi), otherwise p_B = B^2/2.</span>
<span class="sd">            Default: True</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">B0</span> <span class="o">=</span> <span class="n">ensure_ytquantity</span><span class="p">(</span><span class="n">B0</span><span class="p">,</span> <span class="s2">&quot;gauss&quot;</span><span class="p">)</span>
        <span class="n">B</span> <span class="o">=</span> <span class="n">B0</span> <span class="o">*</span> <span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span> <span class="o">**</span> <span class="n">eta</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">gaussian</span><span class="p">:</span>
            <span class="n">B</span> <span class="o">/=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mf">4.0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">set_field</span><span class="p">(</span><span class="s2">&quot;magnetic_field_strength&quot;</span><span class="p">,</span> <span class="n">B</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.generate_tracer_particles"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.generate_tracer_particles.html#model.ClusterModel.generate_tracer_particles">[docs]</a>    <span class="k">def</span> <span class="nf">generate_tracer_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_sample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">prng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="kn">from</span> <span class="nn">cluster_generator.utils</span> <span class="kn">import</span> <span class="n">parse_prng</span>
        <span class="n">prng</span> <span class="o">=</span> <span class="n">parse_prng</span><span class="p">(</span><span class="n">prng</span><span class="p">)</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;We will be assigning </span><span class="si">%d</span><span class="s2"> particles.&quot;</span> <span class="o">%</span> <span class="n">num_particles</span><span class="p">)</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Compute particle positions.&quot;</span><span class="p">)</span>

        <span class="n">num_particles_sub</span> <span class="o">=</span> <span class="n">num_particles</span> <span class="o">//</span> <span class="n">sub_sample</span>

        <span class="n">radius_sub</span><span class="p">,</span> <span class="n">mtot</span> <span class="o">=</span> <span class="n">generate_particle_radii</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gas_mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                                                   <span class="n">num_particles_sub</span><span class="p">,</span>
                                                   <span class="n">r_max</span><span class="o">=</span><span class="n">r_max</span><span class="p">,</span> <span class="n">prng</span><span class="o">=</span><span class="n">prng</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sub_sample</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">radius_sub</span><span class="p">,</span> <span class="n">sub_sample</span><span class="p">)[:</span><span class="n">num_particles</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">radius_sub</span>

        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">prng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_particles</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">prng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">num_particles</span><span class="p">)</span>

        <span class="n">fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;tracer&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span>
             <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span> <span class="s2">&quot;kpc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;tracer&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;tracer&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_position&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">shape</span><span class="p">),</span> <span class="s2">&quot;kpc/Myr&quot;</span>
        <span class="p">)</span>

        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;tracer&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">num_particles</span><span class="p">),</span> <span class="s2">&quot;Msun&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">ClusterParticles</span><span class="p">(</span><span class="s2">&quot;tracer&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.generate_gas_particles"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.generate_gas_particles.html#model.ClusterModel.generate_gas_particles">[docs]</a>    <span class="k">def</span> <span class="nf">generate_gas_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_sample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                               <span class="n">compute_potential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a set of gas particles in hydrostatic equilibrium.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_particles : integer</span>
<span class="sd">            The number of particles to generate.</span>
<span class="sd">        r_max : float, optional</span>
<span class="sd">            The maximum radius in kpc within which to generate </span>
<span class="sd">            particle positions. If not supplied, it will generate</span>
<span class="sd">            positions out to the maximum radius available. Default: None</span>
<span class="sd">        sub_sample : integer, optional</span>
<span class="sd">            This option allows one to generate a sub-sample of unique</span>
<span class="sd">            particle radii, densities, and energies which will then be</span>
<span class="sd">            repeated to fill the required number of particles. Default: 1,</span>
<span class="sd">            which means no sub-sampling.</span>
<span class="sd">        compute_potential : boolean, optional</span>
<span class="sd">            If True, the gravitational potential for each particle will</span>
<span class="sd">            be computed. Default: False</span>
<span class="sd">        prng : :class:`~numpy.random.RandomState` object, integer, or None</span>
<span class="sd">            A pseudo-random number generator. Typically will only </span>
<span class="sd">            be specified if you have a reason to generate the same </span>
<span class="sd">            set of random numbers, such as for a test. Default is None, </span>
<span class="sd">            which sets the seed based on the system time.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">from</span> <span class="nn">cluster_generator.utils</span> <span class="kn">import</span> <span class="n">parse_prng</span>
        <span class="c1">#  Setup</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">prng</span> <span class="o">=</span> <span class="n">parse_prng</span><span class="p">(</span><span class="n">prng</span><span class="p">)</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;We will be assigning </span><span class="si">%d</span><span class="s2"> particles.&quot;</span> <span class="o">%</span> <span class="n">num_particles</span><span class="p">)</span>

        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\t</span><span class="s2">Computing particle positions...&quot;</span><span class="p">)</span>

        <span class="c1"># Determining the number of particles to partition into subsamples.</span>
        <span class="n">num_particles_sub</span> <span class="o">=</span> <span class="n">num_particles</span> <span class="o">//</span> <span class="n">sub_sample</span>

        <span class="c1">#  Sampling</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="c1"># ** --------------- Radii --------------------** #</span>
        <span class="c1"># Inverse distribution sampling to get radii for particles and measure of total mass.</span>
        <span class="n">radius_sub</span><span class="p">,</span> <span class="n">mtot</span> <span class="o">=</span> <span class="n">generate_particle_radii</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                                                   <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gas_mass&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span>
                                                   <span class="n">num_particles_sub</span><span class="p">,</span>
                                                   <span class="n">r_max</span><span class="o">=</span><span class="n">r_max</span><span class="p">,</span> <span class="n">prng</span><span class="o">=</span><span class="n">prng</span><span class="p">)</span>
        <span class="c1"># duplicating the radii sampled</span>
        <span class="k">if</span> <span class="n">sub_sample</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">radius_sub</span><span class="p">,</span> <span class="n">sub_sample</span><span class="p">)[:</span><span class="n">num_particles</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">radius</span> <span class="o">=</span> <span class="n">radius_sub</span>

        <span class="c1"># ** ------------------ Angular Position --------------- ** #</span>
        <span class="n">theta</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arccos</span><span class="p">(</span><span class="n">prng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">low</span><span class="o">=-</span><span class="mf">1.</span><span class="p">,</span> <span class="n">high</span><span class="o">=</span><span class="mf">1.</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">num_particles</span><span class="p">))</span>
        <span class="n">phi</span> <span class="o">=</span> <span class="mf">2.</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span> <span class="o">*</span> <span class="n">prng</span><span class="o">.</span><span class="n">uniform</span><span class="p">(</span><span class="n">size</span><span class="o">=</span><span class="n">num_particles</span><span class="p">)</span>

        <span class="c1">#  Building the fields</span>
        <span class="c1"># ------------------------------------------------------------------------------------------------------------ #</span>
        <span class="n">fields</span> <span class="o">=</span> <span class="n">OrderedDict</span><span class="p">()</span>

        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_position&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span> <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">phi</span><span class="p">),</span>
             <span class="n">radius</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">theta</span><span class="p">)],</span> <span class="s2">&quot;kpc&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>

        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Computing particle thermal energies, densities, and masses.&quot;</span><span class="p">)</span>

        <span class="c1"># --- Fetching energy --- #</span>
        <span class="c1"># ! Using equipartition theorem and ideal gas law.</span>
        <span class="n">e_arr</span> <span class="o">=</span> <span class="mf">1.5</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;pressure&quot;</span><span class="p">]</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">]</span>
        <span class="n">get_energy</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span> <span class="n">e_arr</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">sub_sample</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">get_energy</span><span class="p">(</span><span class="n">radius_sub</span><span class="p">),</span> <span class="n">sub_sample</span><span class="p">)[:</span><span class="n">num_particles</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">energy</span> <span class="o">=</span> <span class="n">get_energy</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;thermal_energy&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">energy</span><span class="p">,</span> <span class="s2">&quot;kpc**2/Myr**2&quot;</span><span class="p">)</span>

        <span class="c1"># --- Fetching the particle mass --- #</span>
        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_mass&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
            <span class="p">[</span><span class="n">mtot</span> <span class="o">/</span> <span class="n">num_particles</span><span class="p">]</span> <span class="o">*</span> <span class="n">num_particles</span><span class="p">,</span> <span class="s2">&quot;Msun&quot;</span><span class="p">)</span>

        <span class="n">get_density</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span>
                                                   <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;density&quot;</span><span class="p">])</span>

        <span class="k">if</span> <span class="n">sub_sample</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">density</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">get_density</span><span class="p">(</span><span class="n">radius_sub</span><span class="p">),</span>
                              <span class="n">sub_sample</span><span class="p">)[:</span><span class="n">num_particles</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">density</span> <span class="o">=</span> <span class="n">get_density</span><span class="p">(</span><span class="n">radius</span><span class="p">)</span>

        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;density&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span><span class="n">density</span><span class="p">,</span> <span class="s2">&quot;Msun/kpc**3&quot;</span><span class="p">)</span>

        <span class="c1"># --- Setting particle velocities --- #</span>
        <span class="c1"># ! These are set to zero because they already have a thermally implied velocity</span>
        <span class="n">mylog</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Set particle velocities to zero.&quot;</span><span class="p">)</span>

        <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_velocity&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
            <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">num_particles</span><span class="p">,</span> <span class="mi">3</span><span class="p">)),</span> <span class="s2">&quot;kpc/Myr&quot;</span><span class="p">)</span>

        <span class="c1"># --- Setting the potential if required --- #</span>
        <span class="k">if</span> <span class="n">compute_potential</span><span class="p">:</span>
            <span class="n">energy_spline</span> <span class="o">=</span> <span class="n">InterpolatedUnivariateSpline</span><span class="p">(</span>
                <span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">d</span><span class="p">,</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;gravitational_potential&quot;</span><span class="p">])</span>
            <span class="n">phi</span> <span class="o">=</span> <span class="o">-</span><span class="n">energy_spline</span><span class="p">(</span><span class="n">radius_sub</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">sub_sample</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">phi</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">phi</span><span class="p">,</span> <span class="n">sub_sample</span><span class="p">)</span>
            <span class="n">fields</span><span class="p">[</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;particle_potential&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">unyt_array</span><span class="p">(</span>
                <span class="n">phi</span><span class="p">,</span> <span class="s2">&quot;kpc**2/Myr**2&quot;</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">ClusterParticles</span><span class="p">(</span><span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="n">fields</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.generate_dm_particles"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.generate_dm_particles.html#model.ClusterModel.generate_dm_particles">[docs]</a>    <span class="k">def</span> <span class="nf">generate_dm_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_sample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                              <span class="n">compute_potential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a set of dark matter particles in virial equilibrium.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_particles : integer</span>
<span class="sd">            The number of particles to generate.</span>
<span class="sd">        r_max : float, optional</span>
<span class="sd">            The maximum radius in kpc within which to generate </span>
<span class="sd">            particle positions. If not supplied, it will generate</span>
<span class="sd">            positions out to the maximum radius available. Default: None</span>
<span class="sd">        sub_sample : integer, optional</span>
<span class="sd">            This option allows one to generate a sub-sample of unique</span>
<span class="sd">            particle radii and velocities which will then be repeated</span>
<span class="sd">            to fill the required number of particles. Default: 1, which</span>
<span class="sd">            means no sub-sampling.</span>
<span class="sd">        compute_potential : boolean, optional</span>
<span class="sd">            If True, the gravitational potential for each particle will</span>
<span class="sd">            be computed. Default: False</span>
<span class="sd">        prng : :class:`~numpy.random.RandomState` object, integer, or None</span>
<span class="sd">            A pseudo-random number generator. Typically will only </span>
<span class="sd">            be specified if you have a reason to generate the same </span>
<span class="sd">            set of random numbers, such as for a test. Default is None, </span>
<span class="sd">            which sets the seed based on the system time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        particles : :class:`~cluster_generator.particles.ClusterParticles`</span>
<span class="sd">            A set of dark matter particles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">dm_virial</span><span class="o">.</span><span class="n">generate_particles</span><span class="p">(</span>
            <span class="n">num_particles</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="n">r_max</span><span class="p">,</span> <span class="n">sub_sample</span><span class="o">=</span><span class="n">sub_sample</span><span class="p">,</span>
            <span class="n">compute_potential</span><span class="o">=</span><span class="n">compute_potential</span><span class="p">,</span> <span class="n">prng</span><span class="o">=</span><span class="n">prng</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.generate_star_particles"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.generate_star_particles.html#model.ClusterModel.generate_star_particles">[docs]</a>    <span class="k">def</span> <span class="nf">generate_star_particles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num_particles</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">sub_sample</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                <span class="n">compute_potential</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">prng</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a set of star particles in virial equilibrium.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        num_particles : integer</span>
<span class="sd">            The number of particles to generate.</span>
<span class="sd">        r_max : float, optional</span>
<span class="sd">            The maximum radius in kpc within which to generate </span>
<span class="sd">            particle positions. If not supplied, it will generate</span>
<span class="sd">            positions out to the maximum radius available. Default: None</span>
<span class="sd">        sub_sample : integer, optional</span>
<span class="sd">            This option allows one to generate a sub-sample of unique</span>
<span class="sd">            particle radii and velocities which will then be repeated</span>
<span class="sd">            to fill the required number of particles. Default: 1, which</span>
<span class="sd">            means no sub-sampling.</span>
<span class="sd">        compute_potential : boolean, optional</span>
<span class="sd">            If True, the gravitational potential for each particle will</span>
<span class="sd">            be computed. Default: False</span>
<span class="sd">        prng : :class:`~numpy.random.RandomState` object, integer, or None</span>
<span class="sd">            A pseudo-random number generator. Typically will only </span>
<span class="sd">            be specified if you have a reason to generate the same </span>
<span class="sd">            set of random numbers, such as for a test. Default is None, </span>
<span class="sd">            which sets the seed based on the system time.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        particles : :class:`~cluster_generator.particles.ClusterParticles`</span>
<span class="sd">            A set of star particles.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">star_virial</span><span class="o">.</span><span class="n">generate_particles</span><span class="p">(</span>
            <span class="n">num_particles</span><span class="p">,</span> <span class="n">r_max</span><span class="o">=</span><span class="n">r_max</span><span class="p">,</span> <span class="n">sub_sample</span><span class="o">=</span><span class="n">sub_sample</span><span class="p">,</span>
            <span class="n">compute_potential</span><span class="o">=</span><span class="n">compute_potential</span><span class="p">,</span> <span class="n">prng</span><span class="o">=</span><span class="n">prng</span><span class="p">)</span></div>

<div class="viewcode-block" id="ClusterModel.plot"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.plot.html#model.ClusterModel.plot">[docs]</a>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">field</span><span class="p">,</span> <span class="n">rmin</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">rmax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fig</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot a field vs radius from this model using Matplotlib.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        field : string</span>
<span class="sd">            The field to plot. </span>
<span class="sd">        r_min : float</span>
<span class="sd">            The minimum radius of the plot in kpc.</span>
<span class="sd">        r_max : float</span>
<span class="sd">            The maximum radius of the plot in kpc.</span>
<span class="sd">        fig : Matplotlib Figure</span>
<span class="sd">            The figure to plot in. Default; None, in which case</span>
<span class="sd">            one will be generated. </span>
<span class="sd">        ax : Matplotlib Axes</span>
<span class="sd">            The axes to plot in. Default: None, in which case</span>
<span class="sd">            one will be generated.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        The Figure, Axes tuple used for the plot. </span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;font&quot;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">18</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s2">&quot;axes&quot;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">fig</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">10</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">amax</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="n">field</span><span class="p">]</span><span class="o">.</span><span class="n">v</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span> <span class="bp">self</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="o">.</span><span class="n">loglog</span><span class="p">(</span><span class="bp">self</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">],</span> <span class="o">-</span><span class="bp">self</span><span class="p">[</span><span class="n">field</span><span class="p">],</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">rmin</span><span class="p">,</span> <span class="n">rmax</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s2">&quot;Radius (kpc)&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;major&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">6</span><span class="p">)</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">tick_params</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s2">&quot;minor&quot;</span><span class="p">,</span> <span class="n">width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">length</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span></div>

<div class="viewcode-block" id="ClusterModel.mass_in_radius"><a class="viewcode-back" href="../_as_gen/model.ClusterModel.mass_in_radius.html#model.ClusterModel.mass_in_radius">[docs]</a>    <span class="k">def</span> <span class="nf">mass_in_radius</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">radius</span><span class="p">):</span>
        <span class="n">masses</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="s2">&quot;radius&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_value</span><span class="p">(</span><span class="s2">&quot;kpc&quot;</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">mtype</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;total&quot;</span><span class="p">,</span> <span class="s2">&quot;gas&quot;</span><span class="p">,</span> <span class="s2">&quot;dark_matter&quot;</span><span class="p">,</span> <span class="s2">&quot;stellar&quot;</span><span class="p">]:</span>
            <span class="k">if</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mtype</span><span class="si">}</span><span class="s2">_mass&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">:</span>
                <span class="n">masses</span><span class="p">[</span><span class="n">mtype</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">fields</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mtype</span><span class="si">}</span><span class="s2">_mass&quot;</span><span class="p">][</span><span class="n">r</span> <span class="o">&lt;</span> <span class="n">radius</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
        <span class="k">return</span> <span class="n">masses</span></div></div>


<span class="c1"># This is only for backwards-compatibility</span>
<div class="viewcode-block" id="HydrostaticEquilibrium"><a class="viewcode-back" href="../_as_gen/model.HydrostaticEquilibrium.html#model.HydrostaticEquilibrium">[docs]</a><span class="k">class</span> <span class="nc">HydrostaticEquilibrium</span><span class="p">(</span><span class="n">ClusterModel</span><span class="p">):</span>
    <span class="k">pass</span></div>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">cluster_generator.tests.utils</span> <span class="kn">import</span> <span class="n">generate_model_dens_temp</span>
    <span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

    <span class="c1"># for logger in [logging.getLogger(name) for name in logging.root.manager.loggerDict]:</span>
    <span class="c1">#    logger.setLevel(&quot;DEBUG&quot;)</span>

    <span class="n">model</span> <span class="o">=</span> <span class="n">generate_model_dens_temp</span><span class="p">(</span><span class="n">gravity</span><span class="o">=</span><span class="s2">&quot;QUMOND&quot;</span><span class="p">)</span>
</pre></div>

                </article>
              
              
              
                <footer class="bd-footer-article">
                  
<div class="footer-article-items footer-article__inner">
  
    <div class="footer-article-item"><!-- Previous / next buttons -->
<div class="prev-next-area">
</div></div>
  
</div>

                </footer>
              
            </div>
            
            
              
            
          </div>
          <footer class="bd-footer-content">
            
          </footer>
        
      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=e353d410970836974a52"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=e353d410970836974a52"></script>

  <footer class="bd-footer">
<div class="bd-footer__inner bd-page-width">
  
    <div class="footer-items__start">
      
        <div class="footer-item">
  <p class="copyright">
    
      © Copyright 2020, John ZuHone and Eliza DIggins.
      <br/>
    
  </p>
</div>
      
        <div class="footer-item">
  <p class="sphinx-version">
    Created using <a href="https://www.sphinx-doc.org/">Sphinx</a> 7.1.2.
    <br/>
  </p>
</div>
      
    </div>
  
  
    <div class="footer-items__end">
      
        <div class="footer-item"><p class="theme-version">
  Built with the <a href="https://pydata-sphinx-theme.readthedocs.io/en/stable/index.html">PyData Sphinx Theme</a> 0.13.3.
</p></div>
      
    </div>
  
</div>

  </footer>
  </body>
</html>